"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[542],{63569:(t,e,r)=>{function n(t){let e;let r=t[0],n=1;for(;n<t.length;){let i=t[n],s=t[n+1];if(n+=2,("optionalAccess"===i||"optionalCall"===i)&&null==r)return;"access"===i||"optionalAccess"===i?(e=r,r=s(r)):("call"===i||"optionalCall"===i)&&(r=s((...t)=>r.call(e,...t)),e=void 0)}return r}t=r.nmd(t),Object.defineProperty(e,"__esModule",{value:!0});var i,s,o,a,c,l,h,u=Object.defineProperty,p=(t,e,r)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,f=(t,e,r)=>(p(t,"symbol"!=typeof e?e+"":e,r),r),d=function(t){return t&&t.__esModule?t:{default:t}}(r(54391)),E=r(19505),m="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,g="object"==typeof self&&self&&self.Object===Object&&self,T=m||g||Function("return this")(),y=T.Symbol,A=Object.prototype,R=A.hasOwnProperty,v=A.toString,O=y?y.toStringTag:void 0,I=function(t){var e=R.call(t,O),r=t[O];try{t[O]=void 0;var n=!0}catch(t){}var i=v.call(t);return n&&(e?t[O]=r:delete t[O]),i},N=Object.prototype.toString,S=y?y.toStringTag:void 0,_=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":S&&S in Object(t)?I(t):N.call(t)},x=function(t){return null!=t&&"object"==typeof t},C=function(t){return"symbol"==typeof t||x(t)&&"[object Symbol]"==_(t)},L=function(t,e){for(var r=-1,n=null==t?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i},k=Array.isArray,b=1/0,P=y?y.prototype:void 0,M=P?P.toString:void 0,w=function t(e){if("string"==typeof e)return e;if(k(e))return L(e,t)+"";if(C(e))return M?M.call(e):"";var r=e+"";return"0"==r&&1/e==-b?"-0":r},U=/\s/,D=function(t){for(var e=t.length;e--&&U.test(t.charAt(e)););return e},F=/^\s+/,$=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},j=0/0,G=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,W=/^0o[0-7]+$/i,z=parseInt,K=function(t){if("number"==typeof t)return t;if(C(t))return j;if($(t)){var e,r="function"==typeof t.valueOf?t.valueOf():t;t=$(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=(e=t)?e.slice(0,D(e)+1).replace(F,""):e;var n=B.test(t);return n||W.test(t)?z(t.slice(2),n?2:8):G.test(t)?j:+t},H=1/0,V=function(t){var e,r=(e=t)?(e=K(e))===H||e===-H?(e<0?-1:1)*17976931348623157e292:e==e?e:0:0===e?e:0,n=r%1;return r==r?n?r-n:r:0},Y=function(t){return t},X=function(t){if(!$(t))return!1;var e=_(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},q=T["__core-js_shared__"],J=function(){var t=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Z=Function.prototype.toString,Q=function(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""},tt=/^\[object .+?Constructor\]$/,te=Object.prototype,tr=Function.prototype.toString,tn=te.hasOwnProperty,ti=RegExp("^"+tr.call(tn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ts=function(t,e){var r,n=null==t?void 0:t[e];return $(r=n)&&(!J||!(J in r))&&(X(r)?ti:tt).test(Q(r))?n:void 0},to=ts(T,"WeakMap"),ta=Object.create,tc=function(){function t(){}return function(e){if(!$(e))return{};if(ta)return ta(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),tl=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)},th=function(){},tu=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e},tp=Date.now,tf=function(){try{var t=ts(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),td=function(t){var e=0,r=0;return function(){var n=tp(),i=16-(n-r);if(r=n,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(tf?function(t,e){return tf(t,"toString",{configurable:!0,enumerable:!1,value:function(){return e},writable:!0})}:Y),tE=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t},tm=function(t,e,r,n){for(var i=t.length,s=r+(n?1:-1);n?s--:++s<i;)if(e(t[s],s,t))return s;return -1},tg=function(t){return t!=t},tT=function(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return -1},ty=function(t,e,r){return e==e?tT(t,e,r):tm(t,tg,r)},tA=function(t,e){return!!(null==t?0:t.length)&&ty(t,e,0)>-1},tR=/^(?:0|[1-9]\d*)$/,tv=function(t,e){var r=typeof t;return!!(e=null==e?0x1fffffffffffff:e)&&("number"==r||"symbol"!=r&&tR.test(t))&&t>-1&&t%1==0&&t<e},tO=function(t,e,r){"__proto__"==e&&tf?tf(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},tI=function(t,e){return t===e||t!=t&&e!=e},tN=Object.prototype.hasOwnProperty,tS=function(t,e,r){var n=t[e];tN.call(t,e)&&tI(n,r)&&(void 0!==r||e in t)||tO(t,e,r)},t_=function(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=n?n(r[a],t[a],a,r,t):void 0;void 0===c&&(c=t[a]),i?tO(r,a,c):tS(r,a,c)}return r},tx=Math.max,tC=function(t,e){var r;return td((r=tx(void 0===(r=e)?t.length-1:r,0),function(){for(var e=arguments,n=-1,i=tx(e.length-r,0),s=Array(i);++n<i;)s[n]=e[r+n];n=-1;for(var o=Array(r+1);++n<r;)o[n]=e[n];return o[r]=Y(s),tl(t,this,o)}),t+"")},tL=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=0x1fffffffffffff},tk=function(t){return null!=t&&tL(t.length)&&!X(t)},tb=function(t,e,r){if(!$(r))return!1;var n=typeof e;return("number"==n?!!(tk(r)&&tv(e,r.length)):"string"==n&&e in r)&&tI(r[e],t)},tP=Object.prototype,tM=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||tP)},tw=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n},tU=function(t){return x(t)&&"[object Arguments]"==_(t)},tD=Object.prototype,tF=tD.hasOwnProperty,t$=tD.propertyIsEnumerable,tj=tU(function(){return arguments}())?tU:function(t){return x(t)&&tF.call(t,"callee")&&!t$.call(t,"callee")},tG=e&&!e.nodeType&&e,tB=tG&&t&&!t.nodeType&&t,tW=tB&&tB.exports===tG?T.Buffer:void 0,tz=(tW?tW.isBuffer:void 0)||function(){return!1},tK={};tK["[object Float32Array]"]=tK["[object Float64Array]"]=tK["[object Int8Array]"]=tK["[object Int16Array]"]=tK["[object Int32Array]"]=tK["[object Uint8Array]"]=tK["[object Uint8ClampedArray]"]=tK["[object Uint16Array]"]=tK["[object Uint32Array]"]=!0,tK["[object Arguments]"]=tK["[object Array]"]=tK["[object ArrayBuffer]"]=tK["[object Boolean]"]=tK["[object DataView]"]=tK["[object Date]"]=tK["[object Error]"]=tK["[object Function]"]=tK["[object Map]"]=tK["[object Number]"]=tK["[object Object]"]=tK["[object RegExp]"]=tK["[object Set]"]=tK["[object String]"]=tK["[object WeakMap]"]=!1;var tH=function(t){return function(e){return t(e)}},tV=e&&!e.nodeType&&e,tY=tV&&t&&!t.nodeType&&t,tX=tY&&tY.exports===tV&&m.process,tq=function(){try{var t=tY&&tY.require&&tY.require("util").types;if(t)return t;return tX&&tX.binding&&tX.binding("util")}catch(t){}}(),tJ=tq&&tq.isTypedArray,tZ=tJ?tH(tJ):function(t){return x(t)&&tL(t.length)&&!!tK[_(t)]},tQ=Object.prototype.hasOwnProperty,t0=function(t,e){var r=k(t),n=!r&&tj(t),i=!r&&!n&&tz(t),s=!r&&!n&&!i&&tZ(t),o=r||n||i||s,a=o?tw(t.length,String):[],c=a.length;for(var l in t)(e||tQ.call(t,l))&&!(o&&("length"==l||i&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||tv(l,c)))&&a.push(l);return a},t1=function(t,e){return function(r){return t(e(r))}},t2=t1(Object.keys,Object),t9=Object.prototype.hasOwnProperty,t6=function(t){if(!tM(t))return t2(t);var e=[];for(var r in Object(t))t9.call(t,r)&&"constructor"!=r&&e.push(r);return e},t3=function(t){return tk(t)?t0(t):t6(t)},t5=Object.prototype.hasOwnProperty,t8=function(t){return tC(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&"function"==typeof s?(i--,s):void 0,o&&tb(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}(function(t,e){if(tM(e)||tk(e)){t_(e,t3(e),t);return}for(var r in e)t5.call(e,r)&&tS(t,r,e[r])}),t4=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e},t7=Object.prototype.hasOwnProperty,et=function(t){if(!$(t))return t4(t);var e=tM(t),r=[];for(var n in t)"constructor"==n&&(e||!t7.call(t,n))||r.push(n);return r},ee=function(t){return tk(t)?t0(t,!0):et(t)},er=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,en=/^\w*$/,ei=function(t,e){if(k(t))return!1;var r=typeof t;return!!("number"==r||"symbol"==r||"boolean"==r||null==t||C(t))||en.test(t)||!er.test(t)||null!=e&&t in Object(e)},es=ts(Object,"create"),eo=Object.prototype.hasOwnProperty,ea=Object.prototype.hasOwnProperty;function ec(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ec.prototype.clear=function(){this.__data__=es?es(null):{},this.size=0},ec.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ec.prototype.get=function(t){var e=this.__data__;if(es){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return eo.call(e,t)?e[t]:void 0},ec.prototype.has=function(t){var e=this.__data__;return es?void 0!==e[t]:ea.call(e,t)},ec.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=es&&void 0===e?"__lodash_hash_undefined__":e,this};var el=function(t,e){for(var r=t.length;r--;)if(tI(t[r][0],e))return r;return -1},eh=Array.prototype.splice;function eu(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}eu.prototype.clear=function(){this.__data__=[],this.size=0},eu.prototype.delete=function(t){var e=this.__data__,r=el(e,t);return!(r<0)&&(r==e.length-1?e.pop():eh.call(e,r,1),--this.size,!0)},eu.prototype.get=function(t){var e=this.__data__,r=el(e,t);return r<0?void 0:e[r][1]},eu.prototype.has=function(t){return el(this.__data__,t)>-1},eu.prototype.set=function(t,e){var r=this.__data__,n=el(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var ep=ts(T,"Map"),ef=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t},ed=function(t,e){var r=t.__data__;return ef(e)?r["string"==typeof e?"string":"hash"]:r.map};function eE(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function em(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw TypeError("Expected a function");var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(em.Cache||eE),r}eE.prototype.clear=function(){this.size=0,this.__data__={hash:new ec,map:new(ep||eu),string:new ec}},eE.prototype.delete=function(t){var e=ed(this,t).delete(t);return this.size-=e?1:0,e},eE.prototype.get=function(t){return ed(this,t).get(t)},eE.prototype.has=function(t){return ed(this,t).has(t)},eE.prototype.set=function(t,e){var r=ed(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this},em.Cache=eE;var eg=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,eT=/\\(\\)?/g,ey=function(t){var e=em(t,function(t){return 500===r.size&&r.clear(),t}),r=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(eg,function(t,r,n,i){e.push(n?i.replace(eT,"$1"):r||t)}),e}),eA=function(t,e){return k(t)?t:ei(t,e)?[t]:ey(null==t?"":w(t))},eR=1/0,ev=function(t){if("string"==typeof t||C(t))return t;var e=t+"";return"0"==e&&1/t==-eR?"-0":e},eO=function(t,e){e=eA(e,t);for(var r=0,n=e.length;null!=t&&r<n;)t=t[ev(e[r++])];return r&&r==n?t:void 0},eI=function(t,e,r){var n=null==t?void 0:eO(t,e);return void 0===n?r:n},eN=function(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t},eS=y?y.isConcatSpreadable:void 0,e_=function(t){return k(t)||tj(t)||!!(eS&&t&&t[eS])},ex=function t(e,r,n,i,s){var o=-1,a=e.length;for(n||(n=e_),s||(s=[]);++o<a;){var c=e[o];r>0&&n(c)?r>1?t(c,r-1,n,i,s):eN(s,c):i||(s[s.length]=c)}return s},eC=function(t){return(null==t?0:t.length)?ex(t,1):[]},eL=t1(Object.getPrototypeOf,Object),ek=function(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(r=r>i?i:r)<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s},eb=function(t,e,r,n){var i=-1,s=null==t?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r};function eP(t){var e=this.__data__=new eu(t);this.size=e.size}eP.prototype.clear=function(){this.__data__=new eu,this.size=0},eP.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},eP.prototype.get=function(t){return this.__data__.get(t)},eP.prototype.has=function(t){return this.__data__.has(t)},eP.prototype.set=function(t,e){var r=this.__data__;if(r instanceof eu){var n=r.__data__;if(!ep||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new eE(n)}return r.set(t,e),this.size=r.size,this};var eM=e&&!e.nodeType&&e,ew=eM&&t&&!t.nodeType&&t,eU=ew&&ew.exports===eM?T.Buffer:void 0,eD=eU?eU.allocUnsafe:void 0,eF=function(t,e){if(e)return t.slice();var r=t.length,n=eD?eD(r):new t.constructor(r);return t.copy(n),n},e$=function(t,e){for(var r=-1,n=null==t?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s},ej=function(){return[]},eG=Object.prototype.propertyIsEnumerable,eB=Object.getOwnPropertySymbols,eW=eB?function(t){return null==t?[]:e$(eB(t=Object(t)),function(e){return eG.call(t,e)})}:ej,ez=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)eN(e,eW(t)),t=eL(t);return e}:ej,eK=function(t,e,r){var n=e(t);return k(t)?n:eN(n,r(t))},eH=function(t){return eK(t,t3,eW)},eV=function(t){return eK(t,ee,ez)},eY=ts(T,"DataView"),eX=ts(T,"Promise"),eq=ts(T,"Set"),eJ="[object Map]",eZ="[object Promise]",eQ="[object Set]",e0="[object WeakMap]",e1="[object DataView]",e2=Q(eY),e9=Q(ep),e6=Q(eX),e3=Q(eq),e5=Q(to),e8=_;(eY&&e8(new eY(new ArrayBuffer(1)))!=e1||ep&&e8(new ep)!=eJ||eX&&e8(eX.resolve())!=eZ||eq&&e8(new eq)!=eQ||to&&e8(new to)!=e0)&&(e8=function(t){var e=_(t),r="[object Object]"==e?t.constructor:void 0,n=r?Q(r):"";if(n)switch(n){case e2:return e1;case e9:return eJ;case e6:return eZ;case e3:return eQ;case e5:return e0}return e});var e4=e8,e7=Object.prototype.hasOwnProperty,rt=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&e7.call(t,"index")&&(r.index=t.index,r.input=t.input),r},re=T.Uint8Array,rr=function(t){var e=new t.constructor(t.byteLength);return new re(e).set(new re(t)),e},rn=function(t,e){var r=e?rr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)},ri=/\w*$/,rs=function(t){var e=new t.constructor(t.source,ri.exec(t));return e.lastIndex=t.lastIndex,e},ro=y?y.prototype:void 0,ra=ro?ro.valueOf:void 0,rc=function(t,e){var r=e?rr(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)},rl=function(t,e,r){var n=t.constructor;switch(e){case"[object ArrayBuffer]":return rr(t);case"[object Boolean]":case"[object Date]":return new n(+t);case"[object DataView]":return rn(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return rc(t,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(t);case"[object RegExp]":return rs(t);case"[object Symbol]":return ra?Object(ra.call(t)):{}}},rh=tq&&tq.isMap,ru=rh?tH(rh):function(t){return x(t)&&"[object Map]"==e4(t)},rp=tq&&tq.isSet,rf=rp?tH(rp):function(t){return x(t)&&"[object Set]"==e4(t)},rd="[object Arguments]",rE="[object Function]",rm="[object Object]",rg={};rg[rd]=rg["[object Array]"]=rg["[object ArrayBuffer]"]=rg["[object DataView]"]=rg["[object Boolean]"]=rg["[object Date]"]=rg["[object Float32Array]"]=rg["[object Float64Array]"]=rg["[object Int8Array]"]=rg["[object Int16Array]"]=rg["[object Int32Array]"]=rg["[object Map]"]=rg["[object Number]"]=rg[rm]=rg["[object RegExp]"]=rg["[object Set]"]=rg["[object String]"]=rg["[object Symbol]"]=rg["[object Uint8Array]"]=rg["[object Uint8ClampedArray]"]=rg["[object Uint16Array]"]=rg["[object Uint32Array]"]=!0,rg["[object Error]"]=rg[rE]=rg["[object WeakMap]"]=!1;var rT=function t(e,r,n,i,s,o){var a,c=1&r,l=2&r,h=4&r;if(n&&(a=s?n(e,i,s,o):n(e)),void 0!==a)return a;if(!$(e))return e;var u=k(e);if(u){if(a=rt(e),!c)return tu(e,a)}else{var p,f,d,E,m=e4(e),g=m==rE||"[object GeneratorFunction]"==m;if(tz(e))return eF(e,c);if(m==rm||m==rd||g&&!s){if(a=l||g?{}:"function"!=typeof e.constructor||tM(e)?{}:tc(eL(e)),!c)return l?(f=(p=a)&&t_(e,ee(e),p),t_(e,ez(e),f)):(E=(d=a)&&t_(e,t3(e),d),t_(e,eW(e),E))}else{if(!rg[m])return s?e:{};a=rl(e,m,c)}}o||(o=new eP);var T=o.get(e);if(T)return T;o.set(e,a),rf(e)?e.forEach(function(i){a.add(t(i,r,n,i,e,o))}):ru(e)&&e.forEach(function(i,s){a.set(s,t(i,r,n,s,e,o))});var y=h?l?eV:eH:l?ee:t3,A=u?void 0:y(e);return tE(A||e,function(i,s){A&&(i=e[s=i]),tS(a,s,t(i,r,n,s,e,o))}),a},ry=function(t){return rT(t,4)},rA=function(t){for(var e=-1,r=null==t?0:t.length,n=0,i=[];++e<r;){var s=t[e];s&&(i[n++]=s)}return i};function rR(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new eE;++e<r;)this.add(t[e])}rR.prototype.add=rR.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},rR.prototype.has=function(t){return this.__data__.has(t)};var rv=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1},rO=function(t,e){return t.has(e)},rI=function(t,e,r,n,i,s){var o=1&r,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),h=s.get(e);if(l&&h)return l==e&&h==t;var u=-1,p=!0,f=2&r?new rR:void 0;for(s.set(t,e),s.set(e,t);++u<a;){var d=t[u],E=e[u];if(n)var m=o?n(E,d,u,e,t,s):n(d,E,u,t,e,s);if(void 0!==m){if(m)continue;p=!1;break}if(f){if(!rv(e,function(t,e){if(!rO(f,e)&&(d===t||i(d,t,r,n,s)))return f.push(e)})){p=!1;break}}else if(!(d===E||i(d,E,r,n,s))){p=!1;break}}return s.delete(t),s.delete(e),p},rN=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t,n){r[++e]=[n,t]}),r},rS=function(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r},r_=y?y.prototype:void 0,rx=r_?r_.valueOf:void 0,rC=function(t,e,r,n,i,s,o){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!s(new re(t),new re(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return tI(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=rN;case"[object Set]":var c=1&n;if(a||(a=rS),t.size!=e.size&&!c)break;var l=o.get(t);if(l)return l==e;n|=2,o.set(t,e);var h=rI(a(t),a(e),n,i,s,o);return o.delete(t),h;case"[object Symbol]":if(rx)return rx.call(t)==rx.call(e)}return!1},rL=Object.prototype.hasOwnProperty,rk=function(t,e,r,n,i,s){var o=1&r,a=eH(t),c=a.length;if(c!=eH(e).length&&!o)return!1;for(var l=c;l--;){var h=a[l];if(!(o?h in e:rL.call(e,h)))return!1}var u=s.get(t),p=s.get(e);if(u&&p)return u==e&&p==t;var f=!0;s.set(t,e),s.set(e,t);for(var d=o;++l<c;){var E=t[h=a[l]],m=e[h];if(n)var g=o?n(m,E,h,e,t,s):n(E,m,h,t,e,s);if(!(void 0===g?E===m||i(E,m,r,n,s):g)){f=!1;break}d||(d="constructor"==h)}if(f&&!d){var T=t.constructor,y=e.constructor;T!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof T&&T instanceof T&&"function"==typeof y&&y instanceof y)&&(f=!1)}return s.delete(t),s.delete(e),f},rb="[object Arguments]",rP="[object Array]",rM="[object Object]",rw=Object.prototype.hasOwnProperty,rU=function(t,e,r,n,i,s){var o=k(t),a=k(e),c=o?rP:e4(t),l=a?rP:e4(e);c=c==rb?rM:c,l=l==rb?rM:l;var h=c==rM,u=l==rM,p=c==l;if(p&&tz(t)){if(!tz(e))return!1;o=!0,h=!1}if(p&&!h)return s||(s=new eP),o||tZ(t)?rI(t,e,r,n,i,s):rC(t,e,c,r,n,i,s);if(!(1&r)){var f=h&&rw.call(t,"__wrapped__"),d=u&&rw.call(e,"__wrapped__");if(f||d){var E=f?t.value():t,m=d?e.value():e;return s||(s=new eP),i(E,m,r,n,s)}}return!!p&&(s||(s=new eP),rk(t,e,r,n,i,s))},rD=function t(e,r,n,i,s){return e===r||(null!=e&&null!=r&&(x(e)||x(r))?rU(e,r,n,i,t,s):e!=e&&r!=r)},rF=function(t,e,r,n){var i=r.length,s=i,o=!n;if(null==t)return!s;for(t=Object(t);i--;){var a=r[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){var c=(a=r[i])[0],l=t[c],h=a[1];if(o&&a[2]){if(void 0===l&&!(c in t))return!1}else{var u=new eP;if(n)var p=n(l,h,c,t,e,u);if(!(void 0===p?rD(h,l,3,n,u):p))return!1}}return!0},r$=function(t){return t==t&&!$(t)},rj=function(t){for(var e=t3(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,r$(i)]}return e},rG=function(t,e){return function(r){return null!=r&&r[t]===e&&(void 0!==e||t in Object(r))}},rB=function(t){var e=rj(t);return 1==e.length&&e[0][2]?rG(e[0][0],e[0][1]):function(r){return r===t||rF(r,t,e)}},rW=function(t,e){return null!=t&&e in Object(t)},rz=function(t,e,r){e=eA(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=ev(e[n]);if(!(s=null!=t&&r(t,o)))break;t=t[o]}return s||++n!=i?s:!!(i=null==t?0:t.length)&&tL(i)&&tv(o,i)&&(k(t)||tj(t))},rK=function(t){var e;return ei(t)?(e=ev(t),function(t){return null==t?void 0:t[e]}):function(e){return eO(e,t)}},rH=function(t){if("function"==typeof t)return t;if(null==t)return Y;if("object"==typeof t){var e,r;return k(t)?(e=t[0],r=t[1],ei(e)&&r$(r)?rG(ev(e),r):function(t){var n=eI(t,e);return void 0===n&&n===r?null!=t&&rz(t,e,rW):rD(r,n,3)}):rB(t)}return rK(t)},rV=function(t,e,r,n){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(n,o,r(o),t)}return n},rY=function(t,e,r){for(var n=-1,i=Object(t),s=r(t),o=s.length;o--;){var a=s[++n];if(!1===e(i[a],a,i))break}return t},rX=(i=function(t,e){return t&&rY(t,e,t3)},function(t,e){if(null==t)return t;if(!tk(t))return i(t,e);for(var r=t.length,n=-1,s=Object(t);++n<r&&!1!==e(s[n],n,s););return t}),rq=Object.prototype,rJ=rq.hasOwnProperty,rZ=tC(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&tb(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=ee(s),a=-1,c=o.length;++a<c;){var l=o[a],h=t[l];(void 0===h||tI(h,rq[l])&&!rJ.call(t,l))&&(t[l]=s[l])}return t}),rQ=function(t){return x(t)&&tk(t)},r0=function(t,e,r){for(var n=-1,i=null==t?0:t.length;++n<i;)if(r(e,t[n]))return!0;return!1},r1=function(t,e,r,n){var i=-1,s=tA,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;r&&(e=L(e,tH(r))),n?(s=r0,o=!1):e.length>=200&&(s=rO,o=!1,e=new rR(e));t:for(;++i<a;){var h=t[i],u=null==r?h:r(h);if(h=n||0!==h?h:0,o&&u==u){for(var p=l;p--;)if(e[p]===u)continue t;c.push(h)}else s(e,u,n)||c.push(h)}return c},r2=tC(function(t,e){return rQ(t)?r1(t,ex(e,1,rQ,!0)):[]}),r9=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},r6=function(t,e,r){var n=null==t?0:t.length;return n?ek(t,(e=r||void 0===e?1:V(e))<0?0:e,n):[]},r3=function(t,e,r){var n=null==t?0:t.length;return n?ek(t,0,(e=n-(e=r||void 0===e?1:V(e)))<0?0:e):[]},r5=function(t,e){return(k(t)?tE:rX)(t,"function"==typeof e?e:Y)},r8=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0},r4=function(t,e){var r=!0;return rX(t,function(t,n,i){return r=!!e(t,n,i)}),r},r7=function(t,e,r){var n=k(t)?r8:r4;return r&&tb(t,e,r)&&(e=void 0),n(t,rH(e,3))},nt=function(t,e){var r=[];return rX(t,function(t,n,i){e(t,n,i)&&r.push(t)}),r},ne=function(t,e){return(k(t)?e$:nt)(t,rH(e,3))},nr=Math.max,nn=(o=function(t,e,r){var n=null==t?0:t.length;if(!n)return -1;var i=null==r?0:V(r);return i<0&&(i=nr(n+i,0)),tm(t,rH(e,3),i)},function(t,e,r){var n=Object(t);if(!tk(t)){var i=rH(e,3);t=t3(t),e=function(t){return i(n[t],t,n)}}var s=o(t,e,r);return s>-1?n[i?t[s]:s]:void 0}),ni=function(t){return t&&t.length?t[0]:void 0},ns=function(t,e){var r=-1,n=tk(t)?Array(t.length):[];return rX(t,function(t,i,s){n[++r]=e(t,i,s)}),n},no=function(t,e){return(k(t)?L:ns)(t,rH(e,3))},na=function(t,e){return ex(no(t,e),1)},nc=Object.prototype.hasOwnProperty,nl=(s=function(t,e,r){nc.call(t,r)?t[r].push(e):tO(t,r,[e])},function(t,e){return(k(t)?rV:function(t,e,r,n){return rX(t,function(t,i,s){e(n,t,r(t),s)}),n})(t,s,rH(e,2),{})}),nh=Object.prototype.hasOwnProperty,nu=function(t,e){return null!=t&&nh.call(t,e)},np=function(t,e){return null!=t&&rz(t,e,nu)},nf=function(t){return"string"==typeof t||!k(t)&&x(t)&&"[object String]"==_(t)},nd=function(t){return null==t?[]:L(t3(t),function(e){return t[e]})},nE=Math.max,nm=function(t,e,r,n){t=tk(t)?t:nd(t),r=r&&!n?V(r):0;var i=t.length;return r<0&&(r=nE(i+r,0)),nf(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&ty(t,e,r)>-1},ng=Math.max,nT=function(t,e,r){var n=null==t?0:t.length;if(!n)return -1;var i=null==r?0:V(r);return i<0&&(i=ng(n+i,0)),ty(t,e,i)},ny=Object.prototype.hasOwnProperty,nA=function(t){if(null==t)return!0;if(tk(t)&&(k(t)||"string"==typeof t||"function"==typeof t.splice||tz(t)||tZ(t)||tj(t)))return!t.length;var e=e4(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(tM(t))return!t6(t).length;for(var r in t)if(ny.call(t,r))return!1;return!0},nR=tq&&tq.isRegExp,nv=nR?tH(nR):function(t){return x(t)&&"[object RegExp]"==_(t)},nO=function(t){return void 0===t},nI=function(t){if("function"!=typeof t)throw TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}},nN=function(t,e,r,n){if(!$(t))return t;e=eA(e,t);for(var i=-1,s=e.length,o=s-1,a=t;null!=a&&++i<s;){var c=ev(e[i]),l=r;if("__proto__"===c||"constructor"===c||"prototype"===c)break;if(i!=o){var h=a[c];void 0===(l=n?n(h,c,a):void 0)&&(l=$(h)?h:tv(e[i+1])?[]:{})}tS(a,c,l),a=a[c]}return t},nS=function(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=eO(t,o);r(a,o)&&nN(s,eA(o,t),a)}return s},n_=function(t,e){if(null==t)return{};var r=L(eV(t),function(t){return[t]});return e=rH(e),nS(t,r,function(t,r){return e(t,r[0])})},nx=function(t,e,r,n,i){return i(t,function(t,i,s){r=n?(n=!1,t):e(r,t,i,s)}),r},nC=function(t,e,r){var n=k(t)?eb:nx,i=arguments.length<3;return n(t,rH(e,4),r,i,rX)},nL=function(t,e){return(k(t)?e$:nt)(t,nI(rH(e,3)))},nk=function(t,e){var r;return rX(t,function(t,n,i){return!(r=e(t,n,i))}),!!r},nb=function(t,e,r){var n=k(t)?rv:nk;return r&&tb(t,e,r)&&(e=void 0),n(t,rH(e,3))},nP=eq&&1/rS(new eq([,-0]))[1]==1/0?function(t){return new eq(t)}:th,nM=function(t,e,r){var n=-1,i=tA,s=t.length,o=!0,a=[],c=a;if(r)o=!1,i=r0;else if(s>=200){var l=e?null:nP(t);if(l)return rS(l);o=!1,i=rO,c=new rR}else c=e?[]:a;t:for(;++n<s;){var h=t[n],u=e?e(h):h;if(h=r||0!==h?h:0,o&&u==u){for(var p=c.length;p--;)if(c[p]===u)continue t;e&&c.push(u),a.push(h)}else i(c,u,r)||(c!==a&&c.push(u),a.push(h))}return a},nw=function(t){return t&&t.length?nM(t):[]};function nU(t){console&&console.error&&console.error(`Error: ${t}`)}function nD(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function nF(t){let e=new Date().getTime(),r=t();return{time:new Date().getTime()-e,value:r}}function n$(t){function e(){}e.prototype=t;let r=new e;function n(){return typeof r.bar}return n(),n(),t}var nj=class{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),r5(this.definition,e=>{e.accept(t)})}},nG=class extends nj{constructor(t){super([]),this.idx=1,t8(this,n_(t,t=>void 0!==t))}set definition(t){}get definition(){return void 0!==this.referencedRule?this.referencedRule.definition:[]}accept(t){t.visit(this)}},nB=class extends nj{constructor(t){super(t.definition),this.orgText="",t8(this,n_(t,t=>void 0!==t))}},nW=class extends nj{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,t8(this,n_(t,t=>void 0!==t))}},nz=class extends nj{constructor(t){super(t.definition),this.idx=1,t8(this,n_(t,t=>void 0!==t))}},nK=class extends nj{constructor(t){super(t.definition),this.idx=1,t8(this,n_(t,t=>void 0!==t))}},nH=class extends nj{constructor(t){super(t.definition),this.idx=1,t8(this,n_(t,t=>void 0!==t))}},nV=class extends nj{constructor(t){super(t.definition),this.idx=1,t8(this,n_(t,t=>void 0!==t))}},nY=class extends nj{constructor(t){super(t.definition),this.idx=1,t8(this,n_(t,t=>void 0!==t))}},nX=class extends nj{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,t8(this,n_(t,t=>void 0!==t))}},nq=class{constructor(t){this.idx=1,t8(this,n_(t,t=>void 0!==t))}accept(t){t.visit(this)}},nJ=class{visit(t){switch(t.constructor){case nG:return this.visitNonTerminal(t);case nW:return this.visitAlternative(t);case nz:return this.visitOption(t);case nK:return this.visitRepetitionMandatory(t);case nH:return this.visitRepetitionMandatoryWithSeparator(t);case nY:return this.visitRepetitionWithSeparator(t);case nV:return this.visitRepetition(t);case nX:return this.visitAlternation(t);case nq:return this.visitTerminal(t);case nB:return this.visitRule(t);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}};function nZ(t,e=[]){return t instanceof nz||t instanceof nV||t instanceof nY||(t instanceof nX?nb(t.definition,t=>nZ(t,e)):!(t instanceof nG&&nm(e,t))&&t instanceof nj&&(t instanceof nG&&e.push(t),r7(t.definition,t=>nZ(t,e))))}function nQ(t){if(t instanceof nG)return"SUBRULE";if(t instanceof nz)return"OPTION";if(t instanceof nX)return"OR";if(t instanceof nK)return"AT_LEAST_ONE";if(t instanceof nH)return"AT_LEAST_ONE_SEP";if(t instanceof nY)return"MANY_SEP";if(t instanceof nV)return"MANY";else if(t instanceof nq)return"CONSUME";else throw Error("non exhaustive match")}var n0=class{walk(t,e=[]){r5(t.definition,(r,n)=>{let i=r6(t.definition,n+1);if(r instanceof nG)this.walkProdRef(r,i,e);else if(r instanceof nq)this.walkTerminal(r,i,e);else if(r instanceof nW)this.walkFlat(r,i,e);else if(r instanceof nz)this.walkOption(r,i,e);else if(r instanceof nK)this.walkAtLeastOne(r,i,e);else if(r instanceof nH)this.walkAtLeastOneSep(r,i,e);else if(r instanceof nY)this.walkManySep(r,i,e);else if(r instanceof nV)this.walkMany(r,i,e);else if(r instanceof nX)this.walkOr(r,i,e);else throw Error("non exhaustive match")})}walkTerminal(t,e,r){}walkProdRef(t,e,r){}walkFlat(t,e,r){let n=e.concat(r);this.walk(t,n)}walkOption(t,e,r){let n=e.concat(r);this.walk(t,n)}walkAtLeastOne(t,e,r){let n=[new nz({definition:t.definition})].concat(e,r);this.walk(t,n)}walkAtLeastOneSep(t,e,r){let n=n1(t,e,r);this.walk(t,n)}walkMany(t,e,r){let n=[new nz({definition:t.definition})].concat(e,r);this.walk(t,n)}walkManySep(t,e,r){let n=n1(t,e,r);this.walk(t,n)}walkOr(t,e,r){let n=e.concat(r);r5(t.definition,t=>{let e=new nW({definition:[t]});this.walk(e,n)})}};function n1(t,e,r){return[new nz({definition:[new nq({terminalType:t.separator})].concat(t.definition)})].concat(e,r)}function n2(t){if(t instanceof nG)return n2(t.referencedRule);if(t instanceof nq)return[t.terminalType];if(t instanceof nW||t instanceof nz||t instanceof nV||t instanceof nK||t instanceof nH||t instanceof nY||t instanceof nq||t instanceof nB)return function(t){let e,r=[],n=t.definition,i=0,s=n.length>i,o=!0;for(;s&&o;)o=nZ(e=n[i]),r=r.concat(n2(e)),i+=1,s=n.length>i;return nw(r)}(t);if(t instanceof nX)return nw(eC(no(t.definition,t=>n2(t))));throw Error("non exhaustive match")}var n9="_~IN~_",n6=class extends n0{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,e,r){}walkProdRef(t,e,r){var n,i;let s=(n=t.referencedRule,i=t.idx,n.name+i+n9+this.topProd.name),o=n2(new nW({definition:e.concat(r)}));this.follows[s]=o}};function n3(t){return t.charCodeAt(0)}function n5(t,e){Array.isArray(t)?t.forEach(function(t){e.push(t)}):e.push(t)}function n8(t,e){if(!0===t[e])throw"duplicate flag "+e;t[e],t[e]=!0}function n4(t){if(void 0===t)throw Error("Internal Error - Should never get here!");return!0}function n7(){throw Error("Internal Error - Should never get here!")}function it(t){return"Character"===t.type}var ie=[];for(let t=n3("0");t<=n3("9");t++)ie.push(t);var ir=[n3("_")].concat(ie);for(let t=n3("a");t<=n3("z");t++)ir.push(t);for(let t=n3("A");t<=n3("Z");t++)ir.push(t);var ii=[n3(" "),n3("\f"),n3("\n"),n3("\r"),n3("	"),n3("\v"),n3("	"),n3("\xa0"),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3(" "),n3("\u2028"),n3("\u2029"),n3(" "),n3(" "),n3("　"),n3("\uFEFF")],is=/[0-9a-fA-F]/,io=/[0-9]/,ia=/[1-9]/,ic=class{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");let e=this.disjunction();this.consumeChar("/");let r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":n8(r,"global");break;case"i":n8(r,"ignoreCase");break;case"m":n8(r,"multiLine");break;case"u":n8(r,"unicode");break;case"y":n8(r,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:e,loc:this.loc(0)}}disjunction(){let t=[],e=this.idx;for(t.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(e)}}alternative(){let t=[],e=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(e)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){let t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":let e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}n4(e);let r=this.disjunction();return this.consumeChar(")"),{type:e,value:r,loc:this.loc(t)}}return n7()}quantifier(t=!1){let e;let r=this.idx;switch(this.popChar()){case"*":e={atLeast:0,atMost:1/0};break;case"+":e={atLeast:1,atMost:1/0};break;case"?":e={atLeast:0,atMost:1};break;case"{":let n=this.integerIncludingZero();switch(this.popChar()){case"}":e={atLeast:n,atMost:n};break;case",":e=this.isDigit()?{atLeast:n,atMost:this.integerIncludingZero()}:{atLeast:n,atMost:1/0},this.consumeChar("}")}if(!0===t&&void 0===e)return;n4(e)}if((!0!==t||void 0!==e)&&n4(e))return"?"===this.peekChar(0)?(this.consumeChar("?"),e.greedy=!1):e.greedy=!0,e.type="Quantifier",e.loc=this.loc(r),e}atom(){let t;let e=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group()}return(void 0===t&&this.isPatternCharacter()&&(t=this.patternCharacter()),n4(t))?(t.loc=this.loc(e),this.isQuantifier()&&(t.quantifier=this.quantifier()),t):n7()}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[n3("\n"),n3("\r"),n3("\u2028"),n3("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t;let e=!1;switch(this.popChar()){case"d":t=ie;break;case"D":t=ie,e=!0;break;case"s":t=ii;break;case"S":t=ii,e=!0;break;case"w":t=ir;break;case"W":t=ir,e=!0}return n4(t)?{type:"Set",value:t,complement:e}:n7()}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=n3("\f");break;case"n":t=n3("\n");break;case"r":t=n3("\r");break;case"t":t=n3("	");break;case"v":t=n3("\v")}return n4(t)?{type:"Character",value:t}:n7()}controlLetterEscapeAtom(){this.consumeChar("c");let t=this.popChar();if(!1===/[a-zA-Z]/.test(t))throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:n3("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){return{type:"Character",value:n3(this.popChar())}}classPatternCharacterAtom(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:n3(this.popChar())}}}characterClass(){let t=[],e=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),e=!0);this.isClassAtom();){let e=this.classAtom();if(e.type,it(e)&&this.isRangeDash()){this.consumeChar("-");let r=this.classAtom();if(r.type,it(r)){if(r.value<e.value)throw Error("Range out of order in character class");t.push({from:e.value,to:r.value})}else n5(e.value,t),t.push(n3("-")),n5(r.value,t)}else n5(e.value,t)}return this.consumeChar("]"),{type:"Set",complement:e,value:t}}classAtom(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:n3("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;(this.consumeChar("("),"?"===this.peekChar(0))?(this.consumeChar("?"),this.consumeChar(":"),t=!1):this.groupIdx++;let e=this.disjunction();this.consumeChar(")");let r={type:"Group",capturing:t,value:e};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(!1===ia.test(t))throw Error("Expecting a positive integer");for(;io.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(!1===io.test(t))throw Error("Expecting an integer");for(;io.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){let t=this.popChar();switch(t){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:n3(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return"-"===this.peekChar()&&this.isClassAtom(1)}isDigit(){return io.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}}isQuantifier(){let t=this.saveState();try{return void 0!==this.quantifier(!0)}catch(t){return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let e="";for(let r=0;r<t;r++){let t=this.popChar();if(!1===is.test(t))throw Error("Expecting a HexDecimal digits");e+=t}return{type:"Character",value:parseInt(e,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){let t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(void 0!==t&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}},il=class{visitChildren(t){for(let e in t){let r=t[e];t.hasOwnProperty(e)&&(void 0!==r.type?this.visit(r):Array.isArray(r)&&r.forEach(t=>{this.visit(t)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t)}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}},ih={},iu=new ic;function ip(t){let e=t.toString();if(ih.hasOwnProperty(e))return ih[e];{let t=iu.pattern(e);return ih[e]=t,t}}var id="Complement Sets are not supported for first char optimization",iE='Unable to use "first char" lexer optimizations:\n';function im(t,e,r){let n=iw(t);e[n]=n,!0===r&&function(t,e){let r=String.fromCharCode(t),n=r.toUpperCase();if(n!==r){let t=iw(n.charCodeAt(0));e[t]=t}else{let t=r.toLowerCase();if(t!==r){let r=iw(t.charCodeAt(0));e[r]=r}}}(t,e)}function ig(t,e){return nn(t.value,t=>"number"==typeof t?nm(e,t):void 0!==nn(e,e=>t.from<=e&&e<=t.to))}var iT=class extends il{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(!0!==this.found){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){nm(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?void 0===ig(t,this.targetCharCodes)&&(this.found=!0):void 0!==ig(t,this.targetCharCodes)&&(this.found=!0)}};function iy(t,e){if(!(e instanceof RegExp))return void 0!==nn(e,e=>nm(t,e.charCodeAt(0)));{let r=ip(e),n=new iT(t);return n.visit(r),n.found}}var iA="PATTERN",iR="defaultMode",iv="modes",iO="boolean"==typeof RegExp("(?:)").sticky,iI=/[^\\][$]/,iN=/[^\\[][\^]|^\^/;function iS(t){let e=t.ignoreCase?"i":"";return RegExp(`^(?:${t.source})`,e)}function i_(t){let e=t.ignoreCase?"iy":"y";return RegExp(`${t.source}`,e)}function ix(t){let e=t.PATTERN;if(nv(e))return!1;if(X(e)||np(e,"exec"))return!0;if(nf(e))return!1;throw Error("non exhaustive match")}function iC(t){return!!nf(t)&&1===t.length&&t.charCodeAt(0)}var iL={test:function(t){let e=t.length;for(let r=this.lastIndex;r<e;r++){let e=t.charCodeAt(r);if(10===e)return this.lastIndex=r+1,!0;if(13===e)return 10===t.charCodeAt(r+1)?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function ik(t,e){if(np(t,"LINE_BREAKS"))return!1;if(nv(t.PATTERN)){try{iy(e,t.PATTERN)}catch(t){return{issue:a.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}if(nf(t.PATTERN))return!1;if(ix(t))return{issue:a.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function ib(t){return no(t,t=>nf(t)?t.charCodeAt(0):t)}function iP(t,e,r){void 0===t[e]?t[e]=[r]:t[e].push(r)}var iM=[];function iw(t){return t<256?t:iM[t]}function iU(t,e){let r=t.tokenTypeIdx;return r===e.tokenTypeIdx||!0===e.isParent&&!0===e.categoryMatchesMap[r]}function iD(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}var iF=1,i$={};function ij(t){let e=function(t){let e=ry(t),r=t,n=!0;for(;n;){let t=r2(r=rA(eC(no(r,t=>t.CATEGORIES))),e);e=e.concat(t),nA(t)?n=!1:r=t}return e}(t);r5(e,t=>{iG(t)||(i$[iF]=t,t.tokenTypeIdx=iF++),iB(t)&&!k(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),iB(t)||(t.CATEGORIES=[]),np(t,"categoryMatches")||(t.categoryMatches=[]),np(t,"categoryMatchesMap")||(t.categoryMatchesMap={})}),r5(e,t=>{(function t(e,r){r5(e,t=>{r.categoryMatchesMap[t.tokenTypeIdx]=!0}),r5(r.CATEGORIES,n=>{let i=e.concat(r);nm(i,n)||t(i,n)})})([],t)}),r5(e,t=>{t.categoryMatches=[],r5(t.categoryMatchesMap,(e,r)=>{t.categoryMatches.push(i$[r].tokenTypeIdx)})}),r5(e,t=>{t.isParent=t.categoryMatches.length>0})}function iG(t){return np(t,"tokenTypeIdx")}function iB(t){return np(t,"CATEGORIES")}function iW(t){return np(t,"tokenTypeIdx")}!function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"}(a||(a={}));var iz={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:{buildUnableToPopLexerModeMessage:t=>`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`,buildUnexpectedCharactersMessage:(t,e,r,n,i)=>`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${r} characters.`},traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(iz);var iK=class{constructor(t,e=iz){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(t,e)=>{if(!0!==this.traceInitPerf)return e();{this.traceInitIndent++;let r=Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);let{time:n,value:i}=nF(e),s=n>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(`${r}<-- <${t}> time: ${n}ms`),this.traceInitIndent--,i}},"boolean"==typeof e)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=t8({},iz,e);let r=this.config.traceInitPerf;!0===r?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"==typeof r&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let r;let n=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===iz.lineTerminatorsPattern)this.config.lineTerminatorsPattern=iL;else if(this.config.lineTerminatorCharacters===iz.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(e.safeMode&&e.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),k(t)?r={modes:{defaultMode:ry(t)},defaultMode:iR}:(n=!1,r=ry(t))}),!1===this.config.skipValidations&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(function(t,e,r){let n=[];return np(t,iR)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+iR+"> property in its definition\n",type:a.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),np(t,iv)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+iv+"> property in its definition\n",type:a.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),np(t,iv)&&np(t,iR)&&!np(t.modes,t.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${iR}: <${t.defaultMode}>which does not exist
`,type:a.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),np(t,iv)&&r5(t.modes,(t,e)=>{r5(t,(r,i)=>{nO(r)?n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${e}> at index: <${i}>
`,type:a.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED}):np(r,"LONGER_ALT")&&r5(k(r.LONGER_ALT)?r.LONGER_ALT:[r.LONGER_ALT],i=>{nO(i)||nm(t,i)||n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${i.name}> on token <${r.name}> outside of mode <${e}>
`,type:a.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})})}),n}(r,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(function(t,e,r){let n=[],i=!1,s=nL(rA(eC(nd(t.modes))),t=>t[iA]===iK.NA),o=ib(r);return e&&r5(s,t=>{let e=ik(t,o);if(!1!==e){let r={message:function(t,e){if(e.issue===a.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===a.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}(t,e),type:e.issue,tokenType:t};n.push(r)}else np(t,"LINE_BREAKS")?!0===t.LINE_BREAKS&&(i=!0):iy(o,t.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:"Warning: No LINE_BREAKS Found.\n	This Lexer has been defined to track line and column information,\n	But none of the Token Types can be identified as matching a line terminator.\n	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n	for details.",type:a.NO_LINE_BREAKS_FLAGS}),n}(r,this.trackStartLines,this.config.lineTerminatorCharacters))})),r.modes=r.modes?r.modes:{},r5(r.modes,(t,e)=>{r.modes[e]=nL(t,t=>nO(t))});let i=t3(r.modes);if(r5(r.modes,(t,r)=>{this.TRACE_INIT(`Mode: <${r}> processing`,()=>{if(this.modes.push(r),!1===this.config.skipValidations&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(function(t,e){let r=[],n=function(t){let e=ne(t,t=>!np(t,iA));return{errors:no(e,t=>({message:"Token Type: ->"+t.name+"<- missing static 'PATTERN' property",type:a.MISSING_PATTERN,tokenTypes:[t]})),valid:r2(t,e)}}(t);r=r.concat(n.errors);let i=function(t){let e=ne(t,t=>{let e=t[iA];return!nv(e)&&!X(e)&&!np(e,"exec")&&!nf(e)});return{errors:no(e,t=>({message:"Token Type: ->"+t.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:a.INVALID_PATTERN,tokenTypes:[t]})),valid:r2(t,e)}}(n.valid),s=i.valid;return(r=(r=(r=(r=r.concat(i.errors)).concat(function(t){let e=[],r=ne(t,t=>nv(t[iA]));return(e=(e=(e=(e=e.concat(function(t){class e extends il{constructor(){super(...arguments),this.found=!1}visitEndAnchor(t){this.found=!0}}return no(ne(t,t=>{let r=t.PATTERN;try{let t=ip(r),n=new e;return n.visit(t),n.found}catch(t){return iI.test(r.source)}}),t=>({message:"Unexpected RegExp Anchor Error:\n	Token Type: ->"+t.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.",type:a.EOI_ANCHOR_FOUND,tokenTypes:[t]}))}(r))).concat(function(t){class e extends il{constructor(){super(...arguments),this.found=!1}visitStartAnchor(t){this.found=!0}}return no(ne(t,t=>{let r=t.PATTERN;try{let t=ip(r),n=new e;return n.visit(t),n.found}catch(t){return iN.test(r.source)}}),t=>({message:"Unexpected RegExp Anchor Error:\n	Token Type: ->"+t.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.",type:a.SOI_ANCHOR_FOUND,tokenTypes:[t]}))}(r))).concat(no(ne(r,t=>{let e=t[iA];return e instanceof RegExp&&(e.multiline||e.global)}),t=>({message:"Token Type: ->"+t.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:a.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[t]})))).concat(function(t){let e=[],r=no(t,r=>nC(t,(t,n)=>(r.PATTERN.source!==n.PATTERN.source||nm(e,n)||n.PATTERN===iK.NA||(e.push(n),t.push(n)),t),[]));return no(ne(r=rA(r),t=>t.length>1),t=>{let e=no(t,t=>t.name),r=ni(t).PATTERN;return{message:`The same RegExp pattern ->${r}<-has been used in all of the following Token Types: ${e.join(", ")} <-`,type:a.DUPLICATE_PATTERNS_FOUND,tokenTypes:t}})}(r))).concat(no(ne(r,t=>t.PATTERN.test("")),t=>({message:"Token Type: ->"+t.name+"<- static 'PATTERN' must not match an empty string",type:a.EMPTY_MATCH_PATTERN,tokenTypes:[t]})))}(s))).concat(no(ne(s,t=>{if(!np(t,"GROUP"))return!1;let e=t.GROUP;return e!==iK.SKIPPED&&e!==iK.NA&&!nf(e)}),t=>({message:"Token Type: ->"+t.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:a.INVALID_GROUP_TYPE_FOUND,tokenTypes:[t]})))).concat(no(ne(s,t=>void 0!==t.PUSH_MODE&&!nm(e,t.PUSH_MODE)),t=>({message:`Token Type: ->${t.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${t.PUSH_MODE}<-which does not exist`,type:a.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[t]})))).concat(function(t){let e=[],r=nC(t,(t,e,r)=>{let n=e.PATTERN;return n===iK.NA||(nf(n)?t.push({str:n,idx:r,tokenType:e}):nv(n)&&void 0===nn([".","\\","[","]","|","^","$","(",")","?","*","+","{"],t=>-1!==n.source.indexOf(t))&&t.push({str:n.source,idx:r,tokenType:e})),t},[]);return r5(t,(t,n)=>{r5(r,({str:r,idx:i,tokenType:s})=>{if(n<i&&function(t,e){if(nv(e)){let r=e.exec(t);return null!==r&&0===r.index}if(X(e))return e(t,0,[],{});if(np(e,"exec"))return e.exec(t,0,[],{});if("string"==typeof e)return e===t;throw Error("non exhaustive match")}(r,t.PATTERN)){let r=`Token: ->${s.name}<- can never be matched.
Because it appears AFTER the Token Type ->${t.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:r,type:a.UNREACHABLE_PATTERN,tokenTypes:[t,s]})}})}),e}(s))}(t,i))}),nA(this.lexerDefinitionErrors)){let n;ij(t),this.TRACE_INIT("analyzeTokenTypes",()=>{n=function(t,e){let r,n,i,s,o,a,c,l,h,u,p,f;let d=(e=rZ(e,{useSticky:iO,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:(t,e)=>e()})).tracer;d("initCharCodeToOptimizedIndexMap",()=>{(function(){if(nA(iM)){iM=Array(65536);for(let t=0;t<65536;t++)iM[t]=t>255?255+~~(t/255):t}})()}),d("Reject Lexer.NA",()=>{r=nL(t,t=>t[iA]===iK.NA)});let E=!1;d("Transform Patterns",()=>{E=!1,n=no(r,t=>{let r=t[iA];if(nv(r)){let t=r.source;return 1!==t.length||"^"===t||"$"===t||"."===t||r.ignoreCase?2!==t.length||"\\"!==t[0]||nm(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],t[1])?e.useSticky?i_(r):iS(r):t[1]:t}if(X(r))return E=!0,{exec:r};if("object"==typeof r)return E=!0,r;if("string"==typeof r){if(1===r.length)return r;{let t=new RegExp(r.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"));return e.useSticky?i_(t):iS(t)}}throw Error("non exhaustive match")})}),d("misc mapping",()=>{i=no(r,t=>t.tokenTypeIdx),s=no(r,t=>{let e=t.GROUP;if(e!==iK.SKIPPED){if(nf(e))return e;if(nO(e))return!1;throw Error("non exhaustive match")}}),o=no(r,t=>{let e=t.LONGER_ALT;if(e)return k(e)?no(e,t=>nT(r,t)):[nT(r,e)]}),a=no(r,t=>t.PUSH_MODE),c=no(r,t=>np(t,"POP_MODE"))}),d("Line Terminator Handling",()=>{let t=ib(e.lineTerminatorCharacters);l=no(r,t=>!1),"onlyOffset"!==e.positionTracking&&(l=no(r,e=>np(e,"LINE_BREAKS")?!!e.LINE_BREAKS:!1===ik(e,t)&&iy(t,e.PATTERN)))}),d("Misc Mapping #2",()=>{h=no(r,ix),u=no(n,iC),p=nC(r,(t,e)=>{let r=e.GROUP;return nf(r)&&r!==iK.SKIPPED&&(t[r]=[]),t},{}),f=no(n,(t,e)=>({pattern:n[e],longerAlt:o[e],canLineTerminator:l[e],isCustom:h[e],short:u[e],group:s[e],push:a[e],pop:c[e],tokenTypeIdx:i[e],tokenType:r[e]}))});let m=!0,g=[];return e.safeMode||d("First Char Optimization",()=>{g=nC(r,(t,r,n)=>{if("string"==typeof r.PATTERN)iP(t,iw(r.PATTERN.charCodeAt(0)),f[n]);else if(k(r.START_CHARS_HINT)){let e;r5(r.START_CHARS_HINT,r=>{let i=iw("string"==typeof r?r.charCodeAt(0):r);e!==i&&(e=i,iP(t,i,f[n]))})}else if(nv(r.PATTERN)){if(r.PATTERN.unicode)m=!1,e.ensureOptimizations&&nU(`${iE}	Unable to analyze < ${r.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{let i=function(t,e=!1){try{let e=ip(t);return function t(e,r,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)t(e.value[i],r,n);break;case"Alternative":let i=e.value;for(let e=0;e<i.length;e++){let s=i[e];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}switch(s.type){case"Character":im(s.value,r,n);break;case"Set":if(!0===s.complement)throw Error(id);r5(s.value,t=>{if("number"==typeof t)im(t,r,n);else if(!0===n)for(let e=t.from;e<=t.to;e++)im(e,r,n);else{for(let e=t.from;e<=t.to&&e<256;e++)im(e,r,n);if(t.to>=256){let e=t.from>=256?t.from:256,n=t.to,i=iw(e),s=iw(n);for(let t=i;t<=s;t++)r[t]=t}}});break;case"Group":t(s.value,r,n);break;default:throw Error("Non Exhaustive Match")}let o=void 0!==s.quantifier&&0===s.quantifier.atLeast;if("Group"===s.type&&!1===function t(e){let r=e.quantifier;return!!r&&0===r.atLeast||!!e.value&&(k(e.value)?r7(e.value,t):t(e.value))}(s)||"Group"!==s.type&&!1===o)break}break;default:throw Error("non exhaustive match!")}return nd(r)}(e.value,{},e.flags.ignoreCase)}catch(r){if(r.message===id)e&&nD(`${iE}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r="\n	This will disable the lexer's first char optimizations.\n	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),nU(`${iE}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}(r.PATTERN,e.ensureOptimizations);nA(i)&&(m=!1),r5(i,e=>{iP(t,e,f[n])})}}else e.ensureOptimizations&&nU(`${iE}	TokenType: <${r.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),m=!1;return t},[])}),{emptyGroups:p,patternIdxToConfig:f,charCodeToPatternIdxToConfig:g,hasCustom:E,canBeOptimized:m}}(t,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:e.positionTracking,ensureOptimizations:e.ensureOptimizations,safeMode:e.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[r]=n.patternIdxToConfig,this.charCodeToPatternIdxToConfig[r]=n.charCodeToPatternIdxToConfig,this.emptyGroups=t8({},this.emptyGroups,n.emptyGroups),this.hasCustom=n.hasCustom||this.hasCustom,this.canModeBeOptimized[r]=n.canBeOptimized}})}),this.defaultMode=r.defaultMode,!nA(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling)throw Error("Errors detected in definition of Lexer:\n"+no(this.lexerDefinitionErrors,t=>t.message).join("-----------------------\n"));r5(this.lexerDefinitionWarning,t=>{nD(t.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(iO?(this.chopInput=Y,this.match=this.matchWithTest):(this.updateLastIndex=th,this.match=this.matchWithExec),n&&(this.handleModes=th),!1===this.trackStartLines&&(this.computeNewColumn=Y),!1===this.trackEndLines&&(this.updateTokenEndLineColumnLocation=th),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{let t=nC(this.canModeBeOptimized,(t,e,r)=>(!1===e&&t.push(r),t),[]);if(e.ensureOptimizations&&!nA(t))throw Error(`Lexer Modes: < ${t.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{ih={}}),this.TRACE_INIT("toFastProperties",()=>{n$(this)})})}tokenize(t,e=this.defaultMode){if(!nA(this.lexerDefinitionErrors))throw Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+no(this.lexerDefinitionErrors,t=>t.message).join("-----------------------\n"));return this.tokenizeInternal(t,e)}tokenizeInternal(t,e){let r,n,i,s,o,a,c,l,h,u,p,f,d,E,m,g,T;let y=t,A=y.length,R=0,v=0,O=Array(this.hasCustom?0:Math.floor(t.length/10)),I=[],N=this.trackStartLines?1:void 0,S=this.trackStartLines?1:void 0,_=function(t){let e={};return r5(t3(t),r=>{if(k(t[r]))e[r]=[];else throw Error("non exhaustive match")}),e}(this.emptyGroups),x=this.trackStartLines,C=this.config.lineTerminatorsPattern,L=0,b=[],P=[],M=[],w=[];function U(){return b}function D(t){let e=P[iw(t)];return void 0===e?w:e}Object.freeze(w);let F=t=>{if(1===M.length&&void 0===t.tokenType.PUSH_MODE){let e=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(t);I.push({offset:t.startOffset,line:t.startLine,column:t.startColumn,length:t.image.length,message:e})}else{M.pop();let t=r9(M);b=this.patternIdxToConfig[t],P=this.charCodeToPatternIdxToConfig[t],L=b.length;let e=this.canModeBeOptimized[t]&&!1===this.config.safeMode;g=P&&e?D:U}};function $(t){M.push(t),P=this.charCodeToPatternIdxToConfig[t],L=(b=this.patternIdxToConfig[t]).length,L=b.length;let e=this.canModeBeOptimized[t]&&!1===this.config.safeMode;g=P&&e?D:U}$.call(this,e);let j=this.config.recoveryEnabled;for(;R<A;){a=null;let e=y.charCodeAt(R),k=g(e),P=k.length;for(r=0;r<P;r++){let n=(T=k[r]).pattern;c=null;let h=T.short;if(!1!==h?e===h&&(a=n):!0===T.isCustom?null!==(m=n.exec(y,R,O,_))?(a=m[0],void 0!==m.payload&&(c=m.payload)):a=null:(this.updateLastIndex(n,R),a=this.match(n,t,R)),null!==a){if(void 0!==(o=T.longerAlt)){let e=o.length;for(i=0;i<e;i++){let e=b[o[i]],r=e.pattern;if(l=null,!0===e.isCustom?null!==(m=r.exec(y,R,O,_))?(s=m[0],void 0!==m.payload&&(l=m.payload)):s=null:(this.updateLastIndex(r,R),s=this.match(r,t,R)),s&&s.length>a.length){a=s,c=l,T=e;break}}}break}}if(null!==a){if(h=a.length,void 0!==(u=T.group)&&(p=T.tokenTypeIdx,f=this.createTokenInstance(a,R,p,T.tokenType,N,S,h),this.handlePayload(f,c),!1===u?v=this.addToken(O,v,f):_[u].push(f)),t=this.chopInput(t,h),R+=h,S=this.computeNewColumn(S,h),!0===x&&!0===T.canLineTerminator){let t,e,r=0;C.lastIndex=0;do!0===(t=C.test(a))&&(e=C.lastIndex-1,r++);while(!0===t);0!==r&&(N+=r,S=h-e,this.updateTokenEndLineColumnLocation(f,u,e,r,N,S,h))}this.handleModes(T,F,$,f)}else{let e=R,r=N,i=S,s=!1===j;for(;!1===s&&R<A;)for(t=this.chopInput(t,1),R++,n=0;n<L;n++){let e=b[n],r=e.pattern,i=e.short;if(!1!==i?y.charCodeAt(R)===i&&(s=!0):!0===e.isCustom?s=null!==r.exec(y,R,O,_):(this.updateLastIndex(r,R),s=null!==r.exec(t)),!0===s)break}if(d=R-e,S=this.computeNewColumn(S,d),E=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(y,e,d,r,i),I.push({offset:e,line:r,column:i,length:d,message:E}),!1===j)break}}return this.hasCustom||(O.length=v),{tokens:O,groups:_,errors:I}}handleModes(t,e,r,n){if(!0===t.pop){let i=t.push;e(n),void 0!==i&&r.call(this,i)}else void 0!==t.push&&r.call(this,t.push)}chopInput(t,e){return t.substring(e)}updateLastIndex(t,e){t.lastIndex=e}updateTokenEndLineColumnLocation(t,e,r,n,i,s,o){let a,c;void 0===e||(c=(a=r===o-1)?-1:0,1===n&&!0===a||(t.endLine=i+c,t.endColumn=s-1+-c))}computeNewColumn(t,e){return t+e}createOffsetOnlyToken(t,e,r,n){return{image:t,startOffset:e,tokenTypeIdx:r,tokenType:n}}createStartOnlyToken(t,e,r,n,i,s){return{image:t,startOffset:e,startLine:i,startColumn:s,tokenTypeIdx:r,tokenType:n}}createFullToken(t,e,r,n,i,s,o){return{image:t,startOffset:e,endOffset:e+o-1,startLine:i,endLine:i,startColumn:s,endColumn:s+o-1,tokenTypeIdx:r,tokenType:n}}addTokenUsingPush(t,e,r){return t.push(r),e}addTokenUsingMemberAccess(t,e,r){return t[e]=r,++e}handlePayloadNoCustom(t,e){}handlePayloadWithCustom(t,e){null!==e&&(t.payload=e)}matchWithTest(t,e,r){return!0===t.test(e)?e.substring(r,t.lastIndex):null}matchWithExec(t,e){let r=t.exec(e);return null!==r?r[0]:null}};function iH(t){return iV(t)?t.LABEL:t.name}function iV(t){return nf(t.LABEL)&&""!==t.LABEL}iK.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",iK.NA=/NOT_APPLICABLE/;var iY="categories",iX="label",iq="group",iJ="push_mode",iZ="pop_mode",iQ="longer_alt",i0="line_breaks",i1="start_chars_hint";function i2(t){let e=t.pattern,r={};if(r.name=t.name,nO(e)||(r.PATTERN=e),np(t,"parent"))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";return np(t,iY)&&(r.CATEGORIES=t[iY]),ij([r]),np(t,iX)&&(r.LABEL=t[iX]),np(t,iq)&&(r.GROUP=t[iq]),np(t,iZ)&&(r.POP_MODE=t[iZ]),np(t,iJ)&&(r.PUSH_MODE=t[iJ]),np(t,iQ)&&(r.LONGER_ALT=t[iQ]),np(t,i0)&&(r.LINE_BREAKS=t[i0]),np(t,i1)&&(r.START_CHARS_HINT=t[i1]),r}var i9=i2({name:"EOF",pattern:iK.NA});function i6(t,e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}ij([i9]);var i3={buildMismatchTokenMessage({expected:t,actual:e,previous:r,ruleName:n}){let i=iV(t)?`--> ${iH(t)} <--`:`token of type --> ${t.name} <--`;return`Expecting ${i} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage:({firstRedundant:t,ruleName:e})=>"Redundant input, expecting EOF but found: "+t.image,buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:r,customUserDescription:n,ruleName:i}){let s="Expecting: ",o="\nbut found: '"+ni(e).image+"'";if(n)return s+n+o;{let e=no(nC(t,(t,e)=>t.concat(e),[]),t=>`[${no(t,t=>iH(t)).join(", ")}]`),r=no(e,(t,e)=>`  ${e+1}. ${t}`);return s+`one of these possible Token sequences:
${r.join("\n")}`+o}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:r,ruleName:n}){let i="Expecting: ",s="\nbut found: '"+ni(e).image+"'";if(r)return i+r+s;{let e=no(t,t=>`[${no(t,t=>iH(t)).join(",")}]`);return i+`expecting at least one iteration which starts with one of these possible Token sequences::
  <${e.join(" ,")}>`+s}}};Object.freeze(i3);var i5={buildRuleNotFoundError:(t,e)=>"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+"<-\ninside top level rule: ->"+t.name+"<-"},i8={buildDuplicateFoundError(t,e){let r=t.name,n=ni(e),i=n.idx,s=nQ(n),o=n instanceof nq?n.terminalType.name:n instanceof nG?n.nonTerminalName:"",a=`->${s}${i>0?i:""}<- ${o?`with argument: ->${o}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return(a=a.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:t=>`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`,buildAlternationPrefixAmbiguityError(t){let e=no(t.prefixPath,t=>iH(t)).join(", "),r=0===t.alternation.idx?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){let e=no(t.prefixPath,t=>iH(t)).join(", "),r=0===t.alternation.idx?"":t.alternation.idx;return`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`},buildEmptyRepetitionError(t){let e=nQ(t.repetition);return 0!==t.repetition.idx&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError:t=>"deprecated",buildEmptyAlternationError:t=>`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`,buildTooManyAlternativesError:t=>`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`,buildLeftRecursionError(t){let e=t.topLevelRule.name,r=no(t.leftRecursionPath,t=>t.name),n=`${e} --> ${r.concat([e]).join(" --\x3e ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError:t=>"deprecated",buildDuplicateRuleNameError(t){let e;return e=t.topLevelRule instanceof nB?t.topLevelRule.name:t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}},i4=class extends nJ{constructor(t,e){super(),this.nameToTopRule=t,this.errMsgProvider=e,this.errors=[]}resolveRefs(){r5(nd(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){let e=this.nameToTopRule[t.nonTerminalName];if(e)t.referencedRule=e;else{let e=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:e,type:h.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}},i7=class extends n0{constructor(t,e){super(),this.topProd=t,this.path=e,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=ry(this.path.ruleStack).reverse(),this.occurrenceStack=ry(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,e=[]){this.found||super.walk(t,e)}walkProdRef(t,e,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){let n=e.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,n)}}updateExpectedNext(){nA(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}},st=class extends i7{constructor(t,e){super(t,e),this.path=e,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,e,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){let t=new nW({definition:e.concat(r)});this.possibleTokTypes=n2(t),this.found=!0}}},se=class extends n0{constructor(t,e){super(),this.topRule=t,this.occurrence=e,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}},sr=class extends se{walkMany(t,e,r){if(t.idx===this.occurrence){let t=ni(e.concat(r));this.result.isEndOfRule=void 0===t,t instanceof nq&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkMany(t,e,r)}},sn=class extends se{walkManySep(t,e,r){if(t.idx===this.occurrence){let t=ni(e.concat(r));this.result.isEndOfRule=void 0===t,t instanceof nq&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkManySep(t,e,r)}},si=class extends se{walkAtLeastOne(t,e,r){if(t.idx===this.occurrence){let t=ni(e.concat(r));this.result.isEndOfRule=void 0===t,t instanceof nq&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkAtLeastOne(t,e,r)}},ss=class extends se{walkAtLeastOneSep(t,e,r){if(t.idx===this.occurrence){let t=ni(e.concat(r));this.result.isEndOfRule=void 0===t,t instanceof nq&&(this.result.token=t.terminalType,this.result.occurrence=t.idx)}else super.walkAtLeastOneSep(t,e,r)}};function so(t,e,r=[]){r=ry(r);let n=[],i=0;function s(s){let o=so(s.concat(r6(t,i+1)),e,r);return n.concat(o)}for(;r.length<e&&i<t.length;){let e=t[i];if(e instanceof nW||e instanceof nG)return s(e.definition);if(e instanceof nz)n=s(e.definition);else if(e instanceof nK)return s(e.definition.concat([new nV({definition:e.definition})]));else if(e instanceof nH)return s([new nW({definition:e.definition}),new nV({definition:[new nq({terminalType:e.separator})].concat(e.definition)})]);else if(e instanceof nY)n=s(e.definition.concat([new nV({definition:[new nq({terminalType:e.separator})].concat(e.definition)})]));else if(e instanceof nV)n=s(e.definition.concat([new nV({definition:e.definition})]));else if(e instanceof nX)return r5(e.definition,t=>{!1===nA(t.definition)&&(n=s(t.definition))}),n;else if(e instanceof nq)r.push(e.terminalType);else throw Error("non exhaustive match");i++}return n.push({partialPath:r,suffixDef:r6(t,i)}),n}function sa(t,e,r,n){let i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE",a=!1,c=e.length,l=c-n-1,h=[],u=[];for(u.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!nA(u);){let t=u.pop();if(t===o){a&&r9(u).idx<=l&&u.pop();continue}let n=t.def,p=t.idx,f=t.ruleStack,d=t.occurrenceStack;if(nA(n))continue;let E=n[0];if(E===i){let t={idx:p,def:r6(n),ruleStack:r3(f),occurrenceStack:r3(d)};u.push(t)}else if(E instanceof nq){if(p<c-1){let t=p+1;if(r(e[t],E.terminalType)){let e={idx:t,def:r6(n),ruleStack:f,occurrenceStack:d};u.push(e)}}else if(p===c-1)h.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:f,occurrenceStack:d}),a=!0;else throw Error("non exhaustive match")}else if(E instanceof nG){let t=ry(f);t.push(E.nonTerminalName);let e=ry(d);e.push(E.idx);let r={idx:p,def:E.definition.concat(s,r6(n)),ruleStack:t,occurrenceStack:e};u.push(r)}else if(E instanceof nz){let t={idx:p,def:r6(n),ruleStack:f,occurrenceStack:d};u.push(t),u.push(o);let e={idx:p,def:E.definition.concat(r6(n)),ruleStack:f,occurrenceStack:d};u.push(e)}else if(E instanceof nK){let t=new nV({definition:E.definition,idx:E.idx}),e={idx:p,def:E.definition.concat([t],r6(n)),ruleStack:f,occurrenceStack:d};u.push(e)}else if(E instanceof nH){let t=new nV({definition:[new nq({terminalType:E.separator})].concat(E.definition),idx:E.idx}),e={idx:p,def:E.definition.concat([t],r6(n)),ruleStack:f,occurrenceStack:d};u.push(e)}else if(E instanceof nY){let t={idx:p,def:r6(n),ruleStack:f,occurrenceStack:d};u.push(t),u.push(o);let e=new nV({definition:[new nq({terminalType:E.separator})].concat(E.definition),idx:E.idx}),r={idx:p,def:E.definition.concat([e],r6(n)),ruleStack:f,occurrenceStack:d};u.push(r)}else if(E instanceof nV){let t={idx:p,def:r6(n),ruleStack:f,occurrenceStack:d};u.push(t),u.push(o);let e=new nV({definition:E.definition,idx:E.idx}),r={idx:p,def:E.definition.concat([e],r6(n)),ruleStack:f,occurrenceStack:d};u.push(r)}else if(E instanceof nX)for(let t=E.definition.length-1;t>=0;t--){let e={idx:p,def:E.definition[t].definition.concat(r6(n)),ruleStack:f,occurrenceStack:d};u.push(e),u.push(o)}else if(E instanceof nW)u.push({idx:p,def:E.definition.concat(r6(n)),ruleStack:f,occurrenceStack:d});else if(E instanceof nB)u.push(function(t,e,r,n){let i=ry(r);i.push(t.name);let s=ry(n);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}(E,p,f,d));else throw Error("non exhaustive match")}return h}function sc(t){if(t instanceof nz||"Option"===t)return c.OPTION;if(t instanceof nV||"Repetition"===t)return c.REPETITION;if(t instanceof nK||"RepetitionMandatory"===t)return c.REPETITION_MANDATORY;if(t instanceof nH||"RepetitionMandatoryWithSeparator"===t)return c.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof nY||"RepetitionWithSeparator"===t)return c.REPETITION_WITH_SEPARATOR;if(t instanceof nX||"Alternation"===t)return c.ALTERNATION;throw Error("non exhaustive match")}function sl(t,e,r,n){let i=t.length,s=r7(t,t=>r7(t,t=>1===t.length));if(e)return function(e){let n=no(e,t=>t.GATE);for(let e=0;e<i;e++){let i=t[e],s=i.length,o=n[e];if(void 0===o||!1!==o.call(this))e:for(let t=0;t<s;t++){let n=i[t],s=n.length;for(let t=0;t<s;t++)if(!1===r(this.LA(t+1),n[t]))continue e;return e}}};if(!s||n)return function(){for(let e=0;e<i;e++){let n=t[e],i=n.length;e:for(let t=0;t<i;t++){let i=n[t],s=i.length;for(let t=0;t<s;t++)if(!1===r(this.LA(t+1),i[t]))continue e;return e}}};{let e=nC(no(t,t=>eC(t)),(t,e,r)=>(r5(e,e=>{np(t,e.tokenTypeIdx)||(t[e.tokenTypeIdx]=r),r5(e.categoryMatches,e=>{np(t,e)||(t[e]=r)})}),t),{});return function(){return e[this.LA(1).tokenTypeIdx]}}}function sh(t,e,r){let n=r7(t,t=>1===t.length),i=t.length;if(!n||r)return function(){e:for(let r=0;r<i;r++){let n=t[r],i=n.length;for(let t=0;t<i;t++)if(!1===e(this.LA(t+1),n[t]))continue e;return!0}return!1};{let e=eC(t);if(1===e.length&&nA(e[0].categoryMatches)){let t=e[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===t}}{let t=nC(e,(t,e,r)=>(t[e.tokenTypeIdx]=!0,r5(e.categoryMatches,e=>{t[e]=!0}),t),[]);return function(){return!0===t[this.LA(1).tokenTypeIdx]}}}}!function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"}(c||(c={}));var su=class extends n0{constructor(t,e,r){super(),this.topProd=t,this.targetOccurrence=e,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,e,r,n){return t.idx===this.targetOccurrence&&this.targetProdType===e&&(this.restDef=r.concat(n),!0)}walkOption(t,e,r){this.checkIsTarget(t,c.OPTION,e,r)||super.walkOption(t,e,r)}walkAtLeastOne(t,e,r){this.checkIsTarget(t,c.REPETITION_MANDATORY,e,r)||super.walkOption(t,e,r)}walkAtLeastOneSep(t,e,r){this.checkIsTarget(t,c.REPETITION_MANDATORY_WITH_SEPARATOR,e,r)||super.walkOption(t,e,r)}walkMany(t,e,r){this.checkIsTarget(t,c.REPETITION,e,r)||super.walkOption(t,e,r)}walkManySep(t,e,r){this.checkIsTarget(t,c.REPETITION_WITH_SEPARATOR,e,r)||super.walkOption(t,e,r)}},sp=class extends nJ{constructor(t,e,r){super(),this.targetOccurrence=t,this.targetProdType=e,this.targetRef=r,this.result=[]}checkIsTarget(t,e){t.idx===this.targetOccurrence&&this.targetProdType===e&&(void 0===this.targetRef||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,c.OPTION)}visitRepetition(t){this.checkIsTarget(t,c.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,c.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,c.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,c.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,c.ALTERNATION)}};function sf(t){let e=Array(t);for(let r=0;r<t;r++)e[r]=[];return e}function sd(t){let e=[""];for(let r=0;r<t.length;r++){let n=t[r],i=[];for(let t=0;t<e.length;t++){let r=e[t];i.push(r+"_"+n.tokenTypeIdx);for(let t=0;t<n.categoryMatches.length;t++){let e="_"+n.categoryMatches[t];i.push(r+e)}}e=i}return e}function sE(t,e){let r=no(t,t=>so([t],1)),n=sf(r.length),i=no(r,t=>{let e={};return r5(t,t=>{r5(sd(t.partialPath),t=>{e[t]=!0})}),e}),s=r;for(let t=1;t<=e;t++){let r=s;s=sf(r.length);for(let o=0;o<r.length;o++){let a=r[o];for(let r=0;r<a.length;r++){let c=a[r].partialPath,l=a[r].suffixDef,h=sd(c);if(function(t,e,r){for(let n=0;n<t.length;n++){if(n===r)continue;let i=t[n];for(let t=0;t<e.length;t++)if(!0===i[e[t]])return!1}return!0}(i,h,o)||nA(l)||c.length===e){let t=n[o];if(!1===sT(t,c)){t.push(c);for(let t=0;t<h.length;t++){let e=h[t];i[o][e]=!0}}}else{let e=so(l,t+1,c);s[o]=s[o].concat(e),r5(e,t=>{r5(sd(t.partialPath),t=>{i[o][t]=!0})})}}}}return n}function sm(t,e,r,n){let i=new sp(t,c.ALTERNATION,n);return e.accept(i),sE(i.result,r)}function sg(t,e,r,n){let i=new sp(t,r);e.accept(i);let s=i.result,o=new su(e,t,r).startWalking();return sE([new nW({definition:s}),new nW({definition:o})],n)}function sT(t,e){r:for(let r=0;r<t.length;r++){let n=t[r];if(n.length===e.length){for(let t=0;t<n.length;t++){let r=e[t],i=n[t];if(!1==(r===i||void 0!==i.categoryMatchesMap[r.tokenTypeIdx]))continue r}return!0}}return!1}function sy(t){return r7(t,t=>r7(t,t=>r7(t,t=>nA(t.categoryMatches))))}function sA(t){return`${nQ(t)}_#_${t.idx}_#_${sR(t)}`}function sR(t){return t instanceof nq?t.terminalType.name:t instanceof nG?t.nonTerminalName:""}var sv=class extends nJ{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}},sO=class extends nJ{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}},sI=class extends nJ{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}},sN="MismatchedTokenException",sS="NoViableAltException",s_="EarlyExitException",sx="NotAllInputParsedException",sC=[sN,sS,s_,sx];function sL(t){return nm(sC,t.name)}Object.freeze(sC);var sk=class extends Error{constructor(t,e){super(t),this.token=e,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},sb=class extends sk{constructor(t,e,r){super(t,e),this.previousToken=r,this.name=sN}},sP=class extends sk{constructor(t,e,r){super(t,e),this.previousToken=r,this.name=sS}},sM=class extends sk{constructor(t,e){super(t,e),this.name=sx}},sw=class extends sk{constructor(t,e,r){super(t,e),this.previousToken=r,this.name=s_}},sU={},sD="InRuleRecoveryException",sF=class extends Error{constructor(t){super(t),this.name=sD}},s$=class{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=np(t,"recoveryEnabled")?t.recoveryEnabled:oe.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=sj)}getTokenToInsert(t){let e=i6(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return e.isInsertedInRecovery=!0,e}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,e,r,n){let i=this.findReSyncTokenType(),s=this.exportLexerState(),o=[],a=!1,c=this.LA(1),l=this.LA(1),h=()=>{let t=this.LA(0),e=new sb(this.errorMessageProvider.buildMismatchTokenMessage({expected:n,actual:c,previous:t,ruleName:this.getCurrRuleFullName()}),c,this.LA(0));e.resyncedTokens=r3(o),this.SAVE_ERROR(e)};for(;!a;){if(this.tokenMatcher(l,n)){h();return}if(r.call(this)){h(),t.apply(this,e);return}this.tokenMatcher(l,i)?a=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,o))}this.importLexerState(s)}shouldInRepetitionRecoveryBeTried(t,e,r){return!(!1===r||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,e)))}getFollowsForInRuleRecovery(t,e){let r=this.getCurrentGrammarPath(t,e);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,e){if(this.canRecoverWithSingleTokenInsertion(t,e))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){let t=this.SKIP_TOKEN();return this.consumeToken(),t}throw new sF("sad sad panda")}canPerformInRuleRecovery(t,e){return this.canRecoverWithSingleTokenInsertion(t,e)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,e){if(!this.canTokenTypeBeInsertedInRecovery(t)||nA(e))return!1;let r=this.LA(1);return void 0!==nn(e,t=>this.tokenMatcher(r,t))}canRecoverWithSingleTokenDeletion(t){return!!this.canTokenTypeBeDeletedInRecovery(t)&&this.tokenMatcher(this.LA(2),t)}isInCurrentRuleReSyncSet(t){let e=this.getCurrFollowKey();return nm(this.getFollowSetFromFollowKey(e),t)}findReSyncTokenType(){let t=this.flattenFollowSet(),e=this.LA(1),r=2;for(;;){let n=nn(t,t=>iU(e,t));if(void 0!==n)return n;e=this.LA(r),r++}}getCurrFollowKey(){if(1===this.RULE_STACK.length)return sU;let t=this.getLastExplicitRuleShortName(),e=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:e,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){let t=this.RULE_STACK,e=this.RULE_OCCURRENCE_STACK;return no(t,(r,n)=>0===n?sU:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:e[n],inRule:this.shortRuleNameToFullName(t[n-1])})}flattenFollowSet(){return eC(no(this.buildFullFollowKeyStack(),t=>this.getFollowSetFromFollowKey(t)))}getFollowSetFromFollowKey(t){if(t===sU)return[i9];let e=t.ruleName+t.idxInCallingRule+n9+t.inRule;return this.resyncFollows[e]}addToResyncTokens(t,e){return this.tokenMatcher(t,i9)||e.push(t),e}reSyncTo(t){let e=[],r=this.LA(1);for(;!1===this.tokenMatcher(r,t);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,e);return r3(e)}attemptInRepetitionRecovery(t,e,r,n,i,s,o){}getCurrentGrammarPath(t,e){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:ry(this.RULE_OCCURRENCE_STACK),lastTok:t,lastTokOccurrence:e}}getHumanReadableRuleStack(){return no(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}};function sj(t,e,r,n,i,s,o){let a=this.getKeyForAutomaticLookahead(n,i),c=this.firstAfterRepMap[a];if(void 0===c){let t=this.getCurrRuleFullName();c=new s(this.getGAstProductions()[t],i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,h=c.occurrence,u=c.isEndOfRule;1===this.RULE_STACK.length&&u&&void 0===l&&(l=i9,h=1),void 0!==l&&void 0!==h&&this.shouldInRepetitionRecoveryBeTried(l,h,o)&&this.tryInRepetitionRecovery(t,e,r,l)}var sG=class{constructor(t){var e;this.maxLookahead=null!==(e=null==t?void 0:t.maxLookahead)&&void 0!==e?e:oe.maxLookahead}validate(t){let e=this.validateNoLeftRecursion(t.rules);return nA(e)?[...e,...this.validateEmptyOrAlternatives(t.rules),...this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),...this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead)]:e}validateNoLeftRecursion(t){return na(t,t=>(function t(e,r,n,i=[]){let s=[],o=function t(e){let r=[];if(nA(e))return r;let n=ni(e);if(n instanceof nG)r.push(n.referencedRule);else if(n instanceof nW||n instanceof nz||n instanceof nK||n instanceof nH||n instanceof nY||n instanceof nV)r=r.concat(t(n.definition));else if(n instanceof nX)r=eC(no(n.definition,e=>t(e.definition)));else if(n instanceof nq);else throw Error("non exhaustive match");let i=nZ(n),s=e.length>1;if(!i||!s)return r;{let n=r6(e);return r.concat(t(n))}}(r.definition);if(nA(o))return[];{let r=e.name;nm(o,e)&&s.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:i}),type:h.LEFT_RECURSION,ruleName:r});let a=na(r2(o,i.concat([e])),r=>{let s=ry(i);return s.push(r),t(e,r,n,s)});return s.concat(a)}})(t,t,i8))}validateEmptyOrAlternatives(t){return na(t,t=>(function(t,e){let r=new sO;return t.accept(r),na(r.alternations,r=>na(r3(r.definition),(n,i)=>nA(sa([n],[],iU,1))?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:r,emptyChoiceIdx:i}),type:h.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:r.idx,alternative:i+1}]:[]))})(t,i8))}validateAmbiguousAlternationAlternatives(t,e){return na(t,t=>(function(t,e,r){let n=new sO;t.accept(n);let i=n.alternations;return na(i=nL(i,t=>!0===t.ignoreAmbiguities),n=>{let i=sm(n.idx,t,n.maxLookahead||e,n),s=function(t,e,r,n){let i=[];return no(nC(t,(r,n,s)=>(!0===e.definition[s].ignoreAmbiguities||r5(n,n=>{let o=[s];r5(t,(t,r)=>{s!==r&&sT(t,n)&&!0!==e.definition[r].ignoreAmbiguities&&o.push(r)}),o.length>1&&!sT(i,n)&&(i.push(n),r.push({alts:o,path:n}))}),r),[]),t=>{let i=no(t.alts,t=>t+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:i,prefixPath:t.path}),type:h.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:e.idx,alternatives:t.alts}})}(i,n,t,r),o=function(t,e,r,n){let i=nC(t,(t,e,r)=>{let n=no(e,t=>({idx:r,path:t}));return t.concat(n)},[]);return rA(na(i,t=>{if(!0===e.definition[t.idx].ignoreAmbiguities)return[];let s=t.idx,o=t.path;return no(ne(i,t=>{var r;return!0!==e.definition[t.idx].ignoreAmbiguities&&t.idx<s&&(r=t.path).length<o.length&&r7(r,(t,e)=>{let r=o[e];return t===r||r.categoryMatchesMap[t.tokenTypeIdx]})}),t=>{let i=[t.idx+1,s+1],o=0===e.idx?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:i,prefixPath:t.path}),type:h.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:o,alternatives:i}})}))}(i,n,t,r);return s.concat(o)})})(t,e,i8))}validateSomeNonEmptyLookaheadPath(t,e){return function(t,e,r){let n=[];return r5(t,t=>{let i=new sI;t.accept(i),r5(i.allProductions,i=>{let s=sc(i),o=i.maxLookahead||e;if(nA(eC(sg(i.idx,t,s,o)[0]))){let e=r.buildEmptyRepetitionError({topLevelRule:t,repetition:i});n.push({message:e,type:h.NO_NON_EMPTY_LOOKAHEAD,ruleName:t.name})}})}),n}(t,e,i8)}buildLookaheadForAlternation(t){return function(t,e,r,n,i,s){let o=sm(t,e,r),a=sy(o)?iD:iU;return s(o,n,a,i)}(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,sl)}buildLookaheadForOptional(t){return function(t,e,r,n,i,s){let o=sg(t,e,i,r),a=sy(o)?iD:iU;return s(o[0],a,n)}(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,sc(t.prodType),sh)}},sB=class{initLooksAhead(t){this.dynamicTokensEnabled=np(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:oe.dynamicTokensEnabled,this.maxLookahead=np(t,"maxLookahead")?t.maxLookahead:oe.maxLookahead,this.lookaheadStrategy=np(t,"lookaheadStrategy")?t.lookaheadStrategy:new sG({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){r5(t,t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,()=>{let{alternation:e,repetition:r,option:n,repetitionMandatory:i,repetitionMandatoryWithSeparator:s,repetitionWithSeparator:o}=function(t){sW.reset(),t.accept(sW);let e=sW.dslMethods;return sW.reset(),e}(t);r5(e,e=>{let r=0===e.idx?"":e.idx;this.TRACE_INIT(`${nQ(e)}${r}`,()=>{var r;let n=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:e.idx,rule:t,maxLookahead:e.maxLookahead||this.maxLookahead,hasPredicates:e.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),i=(r=this.fullRuleNameToShort[t.name],256|e.idx|r);this.setLaFuncCache(i,n)})}),r5(r,e=>{this.computeLookaheadFunc(t,e.idx,768,"Repetition",e.maxLookahead,nQ(e))}),r5(n,e=>{this.computeLookaheadFunc(t,e.idx,512,"Option",e.maxLookahead,nQ(e))}),r5(i,e=>{this.computeLookaheadFunc(t,e.idx,1024,"RepetitionMandatory",e.maxLookahead,nQ(e))}),r5(s,e=>{this.computeLookaheadFunc(t,e.idx,1536,"RepetitionMandatoryWithSeparator",e.maxLookahead,nQ(e))}),r5(o,e=>{this.computeLookaheadFunc(t,e.idx,1280,"RepetitionWithSeparator",e.maxLookahead,nQ(e))})})})}computeLookaheadFunc(t,e,r,n,i,s){this.TRACE_INIT(`${s}${0===e?"":e}`,()=>{let s=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:e,rule:t,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:n}),o=e|r|this.fullRuleNameToShort[t.name];this.setLaFuncCache(o,s)})}getKeyForAutomaticLookahead(t,e){return e|t|this.getLastExplicitRuleShortName()}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,e){this.lookAheadFuncsCache.set(t,e)}},sW=new class extends nJ{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}};function sz(t,e){!0===isNaN(t.startOffset)?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset==!0&&(t.endOffset=e.endOffset)}function sK(t,e){!0===isNaN(t.startOffset)?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset==!0&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function sH(t,e){Object.defineProperty(t,"name",{enumerable:!1,configurable:!0,writable:!1,value:e})}function sV(t,e){let r=t3(t),n=r.length;for(let i=0;i<n;i++){let n=t[r[i]],s=n.length;for(let t=0;t<s;t++){let r=n[t];void 0===r.tokenTypeIdx&&this[r.name](r.children,e)}}}!function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"}(l||(l={}));var sY=class{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=np(t,"nodeLocationTracking")?t.nodeLocationTracking:oe.nodeLocationTracking,this.outputCst){if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=sK,this.setNodeLocationFromNode=sK,this.cstPostRule=th,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=th,this.setNodeLocationFromNode=th,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=sz,this.setNodeLocationFromNode=sz,this.cstPostRule=th,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=th,this.setNodeLocationFromNode=th,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=th,this.setNodeLocationFromNode=th,this.cstPostRule=th,this.setInitialNodeLocation=th;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}else this.cstInvocationStateUpdate=th,this.cstFinallyStateUpdate=th,this.cstPostTerminal=th,this.cstPostNonTerminal=th,this.cstPostRule=th}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){let e=this.LA(1);t.location={startOffset:e.startOffset,startLine:e.startLine,startColumn:e.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){let e={name:t,children:Object.create(null)};this.setInitialNodeLocation(e),this.CST_STACK.push(e)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){let e=this.LA(0),r=t.location;r.startOffset<=e.startOffset==!0?(r.endOffset=e.endOffset,r.endLine=e.endLine,r.endColumn=e.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){let e=this.LA(0),r=t.location;r.startOffset<=e.startOffset==!0?r.endOffset=e.endOffset:r.startOffset=NaN}cstPostTerminal(t,e){let r=this.CST_STACK[this.CST_STACK.length-1];void 0===r.children[t]?r.children[t]=[e]:r.children[t].push(e),this.setNodeLocationFromToken(r.location,e)}cstPostNonTerminal(t,e){let r=this.CST_STACK[this.CST_STACK.length-1];void 0===r.children[e]?r.children[e]=[t]:r.children[e].push(t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(nO(this.baseCstVisitorConstructor)){let t=function(t,e){let r=function(){};return sH(r,t+"BaseSemantics"),r.prototype={visit:function(t,e){if(k(t)&&(t=t[0]),!nO(t))return this[t.name](t.children,e)},validateVisitor:function(){var t;let r=(t=this,rA(no(ne(e,e=>!1===X(t[e])),e=>({msg:`Missing visitor method: <${e}> on ${t.constructor.name} CST Visitor.`,type:l.MISSING_METHOD,methodName:e}))));if(!nA(r)){let t=no(r,t=>t.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${t.join("\n\n").replace(/\n/g,"\n	")}`)}}},r.prototype.constructor=r,r._RULE_NAMES=e,r}(this.className,t3(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(nO(this.baseCstVisitorWithDefaultsConstructor)){let t=function(t,e,r){let n=function(){};sH(n,t+"BaseSemanticsWithDefaults");let i=Object.create(r.prototype);return r5(e,t=>{i[t]=sV}),n.prototype=i,n.prototype.constructor=n,n}(this.className,t3(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){let t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){let t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){let t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}},sX=class{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):ot}LA(t){let e=this.currIdx+t;return e<0||this.tokVectorLength<=e?ot:this.tokVector[e]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}},sq=class{ACTION(t){return t.call(this)}consume(t,e,r){return this.consumeInternal(e,t,r)}subrule(t,e,r){return this.subruleInternal(e,t,r)}option(t,e){return this.optionInternal(e,t)}or(t,e){return this.orInternal(e,t)}many(t,e){return this.manyInternal(t,e)}atLeastOne(t,e){return this.atLeastOneInternal(t,e)}CONSUME(t,e){return this.consumeInternal(t,0,e)}CONSUME1(t,e){return this.consumeInternal(t,1,e)}CONSUME2(t,e){return this.consumeInternal(t,2,e)}CONSUME3(t,e){return this.consumeInternal(t,3,e)}CONSUME4(t,e){return this.consumeInternal(t,4,e)}CONSUME5(t,e){return this.consumeInternal(t,5,e)}CONSUME6(t,e){return this.consumeInternal(t,6,e)}CONSUME7(t,e){return this.consumeInternal(t,7,e)}CONSUME8(t,e){return this.consumeInternal(t,8,e)}CONSUME9(t,e){return this.consumeInternal(t,9,e)}SUBRULE(t,e){return this.subruleInternal(t,0,e)}SUBRULE1(t,e){return this.subruleInternal(t,1,e)}SUBRULE2(t,e){return this.subruleInternal(t,2,e)}SUBRULE3(t,e){return this.subruleInternal(t,3,e)}SUBRULE4(t,e){return this.subruleInternal(t,4,e)}SUBRULE5(t,e){return this.subruleInternal(t,5,e)}SUBRULE6(t,e){return this.subruleInternal(t,6,e)}SUBRULE7(t,e){return this.subruleInternal(t,7,e)}SUBRULE8(t,e){return this.subruleInternal(t,8,e)}SUBRULE9(t,e){return this.subruleInternal(t,9,e)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,e,r=or){if(nm(this.definedRulesNames,t)){let e={message:i8.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:h.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(e)}this.definedRulesNames.push(t);let n=this.defineRule(t,e,r);return this[t]=n,n}OVERRIDE_RULE(t,e,r=or){let n=function(t,e,r){let n=[];return nm(e,t)||n.push({message:`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,type:h.INVALID_RULE_OVERRIDE,ruleName:t}),n}(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(n);let i=this.defineRule(t,e,r);return this[t]=i,i}BACKTRACK(t,e){return function(){this.isBackTrackingStack.push(1);let r=this.saveRecogState();try{return t.apply(this,e),!0}catch(t){if(sL(t))return!1;throw t}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return no(nd(this.gastProductionsCache),function t(e){function r(e){return no(e,t)}if(e instanceof nG){let t={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return nf(e.label)&&(t.label=e.label),t}if(e instanceof nW)return{type:"Alternative",definition:r(e.definition)};if(e instanceof nz)return{type:"Option",idx:e.idx,definition:r(e.definition)};if(e instanceof nK)return{type:"RepetitionMandatory",idx:e.idx,definition:r(e.definition)};if(e instanceof nH)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:t(new nq({terminalType:e.separator})),definition:r(e.definition)};if(e instanceof nY)return{type:"RepetitionWithSeparator",idx:e.idx,separator:t(new nq({terminalType:e.separator})),definition:r(e.definition)};if(e instanceof nV)return{type:"Repetition",idx:e.idx,definition:r(e.definition)};else if(e instanceof nX)return{type:"Alternation",idx:e.idx,definition:r(e.definition)};else if(e instanceof nq){var n,i;let t={type:"Terminal",name:e.terminalType.name,label:nf((i=n=e.terminalType).LABEL)&&""!==i.LABEL?n.LABEL:n.name,idx:e.idx};nf(e.label)&&(t.terminalLabel=e.label);let r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(t.pattern=nv(r)?r.source:r),t}else if(e instanceof nB)return{type:"Rule",name:e.name,orgText:e.orgText,definition:r(e.definition)};else throw Error("non exhaustive match")})}},sJ=class{initRecognizerEngine(t,e){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=iD,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},np(e,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n	For Further details.");if(k(t)){if(nA(t))throw Error("A Token Vocabulary cannot be empty.\n	Note that the first argument for the parser constructor\n	is no longer a Token vector (since v4.0).");if("number"==typeof t[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n	For Further details.")}if(k(t))this.tokensMap=nC(t,(t,e)=>(t[e.name]=e,t),{});else if(np(t,"modes")&&r7(eC(nd(t.modes)),iW)){let e=nw(eC(nd(t.modes)));this.tokensMap=nC(e,(t,e)=>(t[e.name]=e,t),{})}else if($(t))this.tokensMap=ry(t);else throw Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=i9;let r=r7(np(t,"modes")?eC(nd(t.modes)):nd(t),t=>nA(t.categoryMatches));this.tokenMatcher=r?iD:iU,ij(nd(this.tokensMap))}defineRule(t,e,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);let n=np(r,"resyncEnabled")?r.resyncEnabled:or.resyncEnabled,i=np(r,"recoveryValueFunc")?r.recoveryValueFunc:or.recoveryValueFunc,s=this.ruleShortNameIdx<<12;return this.ruleShortNameIdx++,this.shortRuleNameToFull[s]=t,this.fullRuleNameToShort[t]=s,Object.assign(!0===this.outputCst?function(...r){try{this.ruleInvocationStateUpdate(s,t,this.subruleIdx),e.apply(this,r);let n=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(n),n}catch(t){return this.invokeRuleCatch(t,n,i)}finally{this.ruleFinallyStateUpdate()}}:function(...r){try{return this.ruleInvocationStateUpdate(s,t,this.subruleIdx),e.apply(this,r)}catch(t){return this.invokeRuleCatch(t,n,i)}finally{this.ruleFinallyStateUpdate()}},{ruleName:t,originalGrammarAction:e})}invokeRuleCatch(t,e,r){let n=1===this.RULE_STACK.length,i=e&&!this.isBackTracking()&&this.recoveryEnabled;if(sL(t)){if(i){let e=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(e)){if(t.resyncedTokens=this.reSyncTo(e),!this.outputCst)return r(t);{let t=this.CST_STACK[this.CST_STACK.length-1];return t.recoveredNode=!0,t}}if(this.outputCst){let e=this.CST_STACK[this.CST_STACK.length-1];e.recoveredNode=!0,t.partialCstResult=e}throw t}if(n)return this.moveToTerminatedState(),r(t)}throw t}optionInternal(t,e){let r=this.getKeyForAutomaticLookahead(512,e);return this.optionInternalLogic(t,e,r)}optionInternalLogic(t,e,r){let n,i=this.getLaFuncFromCache(r);if("function"!=typeof t){n=t.DEF;let e=t.GATE;if(void 0!==e){let t=i;i=()=>e.call(this)&&t.call(this)}}else n=t;if(!0===i.call(this))return n.call(this)}atLeastOneInternal(t,e){let r=this.getKeyForAutomaticLookahead(1024,t);return this.atLeastOneInternalLogic(t,e,r)}atLeastOneInternalLogic(t,e,r){let n,i=this.getLaFuncFromCache(r);if("function"!=typeof e){n=e.DEF;let t=e.GATE;if(void 0!==t){let e=i;i=()=>t.call(this)&&e.call(this)}}else n=e;if(!0===i.call(this)){let t=this.doSingleRepetition(n);for(;!0===i.call(this)&&!0===t;)t=this.doSingleRepetition(n)}else throw this.raiseEarlyExitException(t,c.REPETITION_MANDATORY,e.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,e],i,1024,t,si)}atLeastOneSepFirstInternal(t,e){let r=this.getKeyForAutomaticLookahead(1536,t);this.atLeastOneSepFirstInternalLogic(t,e,r)}atLeastOneSepFirstInternalLogic(t,e,r){let n=e.DEF,i=e.SEP;if(!0===this.getLaFuncFromCache(r).call(this)){n.call(this);let e=()=>this.tokenMatcher(this.LA(1),i);for(;!0===this.tokenMatcher(this.LA(1),i);)this.CONSUME(i),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,e,n,ss],e,1536,t,ss)}else throw this.raiseEarlyExitException(t,c.REPETITION_MANDATORY_WITH_SEPARATOR,e.ERR_MSG)}manyInternal(t,e){let r=this.getKeyForAutomaticLookahead(768,t);return this.manyInternalLogic(t,e,r)}manyInternalLogic(t,e,r){let n,i=this.getLaFuncFromCache(r);if("function"!=typeof e){n=e.DEF;let t=e.GATE;if(void 0!==t){let e=i;i=()=>t.call(this)&&e.call(this)}}else n=e;let s=!0;for(;!0===i.call(this)&&!0===s;)s=this.doSingleRepetition(n);this.attemptInRepetitionRecovery(this.manyInternal,[t,e],i,768,t,sr,s)}manySepFirstInternal(t,e){let r=this.getKeyForAutomaticLookahead(1280,t);this.manySepFirstInternalLogic(t,e,r)}manySepFirstInternalLogic(t,e,r){let n=e.DEF,i=e.SEP;if(!0===this.getLaFuncFromCache(r).call(this)){n.call(this);let e=()=>this.tokenMatcher(this.LA(1),i);for(;!0===this.tokenMatcher(this.LA(1),i);)this.CONSUME(i),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,e,n,sn],e,1280,t,sn)}}repetitionSepSecondInternal(t,e,r,n,i){for(;r();)this.CONSUME(e),n.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,e,r,n,i],r,1536,t,i)}doSingleRepetition(t){let e=this.getLexerPosition();return t.call(this),this.getLexerPosition()>e}orInternal(t,e){let r=this.getKeyForAutomaticLookahead(256,e),n=k(t)?t:t.DEF,i=this.getLaFuncFromCache(r).call(this,n);if(void 0!==i)return n[i].ALT.call(this);this.raiseNoAltException(e,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){let t=this.LA(1),e=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new sM(e,t))}}subruleInternal(t,e,r){let n;try{let i=void 0!==r?r.ARGS:void 0;return this.subruleIdx=e,n=t.apply(this,i),this.cstPostNonTerminal(n,void 0!==r&&void 0!==r.LABEL?r.LABEL:t.ruleName),n}catch(e){throw this.subruleInternalError(e,r,t.ruleName)}}subruleInternalError(t,e,r){throw sL(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==e&&void 0!==e.LABEL?e.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,e,r){let n;try{let e=this.LA(1);!0===this.tokenMatcher(e,t)?(this.consumeToken(),n=e):this.consumeInternalError(t,e,r)}catch(r){n=this.consumeInternalRecovery(t,e,r)}return this.cstPostTerminal(void 0!==r&&void 0!==r.LABEL?r.LABEL:t.name,n),n}consumeInternalError(t,e,r){let n;let i=this.LA(0);throw n=void 0!==r&&r.ERR_MSG?r.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:e,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new sb(n,e,i))}consumeInternalRecovery(t,e,r){if(this.recoveryEnabled&&"MismatchedTokenException"===r.name&&!this.isBackTracking()){let n=this.getFollowsForInRuleRecovery(t,e);try{return this.tryInRuleRecovery(t,n)}catch(t){if(t.name===sD)throw r;throw t}}else throw r}saveRecogState(){let t=this.errors,e=ry(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:e,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,e,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(e)}isBackTracking(){return 0!==this.isBackTrackingStack.length}getCurrRuleFullName(){let t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),i9)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}},sZ=class{initErrorHandler(t){this._errors=[],this.errorMessageProvider=np(t,"errorMessageProvider")?t.errorMessageProvider:oe.errorMessageProvider}SAVE_ERROR(t){if(sL(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:ry(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return ry(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,e,r){let n=this.getCurrRuleFullName(),i=sg(t,this.getGAstProductions()[n],e,this.maxLookahead)[0],s=[];for(let t=1;t<=this.maxLookahead;t++)s.push(this.LA(t));let o=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:i,actual:s,previous:this.LA(0),customUserDescription:r,ruleName:n});throw this.SAVE_ERROR(new sw(o,this.LA(1),this.LA(0)))}raiseNoAltException(t,e){let r=this.getCurrRuleFullName(),n=sm(t,this.getGAstProductions()[r],this.maxLookahead),i=[];for(let t=1;t<=this.maxLookahead;t++)i.push(this.LA(t));let s=this.LA(0),o=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:n,actual:i,previous:s,customUserDescription:e,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new sP(o,this.LA(1),s))}},sQ=class{initContentAssist(){}computeContentAssist(t,e){let r=this.gastProductionsCache[t];if(nO(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return sa([r],e,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){let e=ni(t.ruleStack);return new st(this.getGAstProductions()[e],t).startWalking()}},s0={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(s0);var s1=i2({name:"RECORDING_PHASE_TOKEN",pattern:iK.NA});ij([s1]);var s2=i6(s1,"This IToken indicates the Parser is in Recording Phase\n	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(s2);var s9={name:"This CSTNode indicates the Parser is in Recording Phase\n	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}},s6=class{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){let e=t>0?t:"";this[`CONSUME${e}`]=function(e,r){return this.consumeInternalRecord(e,t,r)},this[`SUBRULE${e}`]=function(e,r){return this.subruleInternalRecord(e,t,r)},this[`OPTION${e}`]=function(e){return this.optionInternalRecord(e,t)},this[`OR${e}`]=function(e){return this.orInternalRecord(e,t)},this[`MANY${e}`]=function(e){this.manyInternalRecord(t,e)},this[`MANY_SEP${e}`]=function(e){this.manySepFirstInternalRecord(t,e)},this[`AT_LEAST_ONE${e}`]=function(e){this.atLeastOneInternalRecord(t,e)},this[`AT_LEAST_ONE_SEP${e}`]=function(e){this.atLeastOneSepFirstInternalRecord(t,e)}}this.consume=function(t,e,r){return this.consumeInternalRecord(e,t,r)},this.subrule=function(t,e,r){return this.subruleInternalRecord(e,t,r)},this.option=function(t,e){return this.optionInternalRecord(e,t)},this.or=function(t,e){return this.orInternalRecord(e,t)},this.many=function(t,e){this.manyInternalRecord(t,e)},this.atLeastOne=function(t,e){this.atLeastOneInternalRecord(t,e)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{for(let t=0;t<10;t++){let e=t>0?t:"";delete this[`CONSUME${e}`],delete this[`SUBRULE${e}`],delete this[`OPTION${e}`],delete this[`OR${e}`],delete this[`MANY${e}`],delete this[`MANY_SEP${e}`],delete this[`AT_LEAST_ONE${e}`],delete this[`AT_LEAST_ONE_SEP${e}`]}delete this.consume,delete this.subrule,delete this.option,delete this.or,delete this.many,delete this.atLeastOne,delete this.ACTION,delete this.BACKTRACK,delete this.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,e){return()=>!0}LA_RECORD(t){return ot}topLevelRuleRecord(t,e){try{let r=new nB({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),e.call(this),this.recordingProdStack.pop(),r}catch(t){if(!0!==t.KNOWN_RECORDER_ERROR)try{t.message=t.message+'\n	 This error was thrown during the "grammar recording phase" For more info see:\n	https://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(t){}throw t}}optionInternalRecord(t,e){return s3.call(this,nz,t,e)}atLeastOneInternalRecord(t,e){s3.call(this,nK,e,t)}atLeastOneSepFirstInternalRecord(t,e){s3.call(this,nH,e,t,!0)}manyInternalRecord(t,e){s3.call(this,nV,e,t)}manySepFirstInternalRecord(t,e){s3.call(this,nY,e,t,!0)}orInternalRecord(t,e){return s5.call(this,t,e)}subruleInternalRecord(t,e,r){if(s4(e),!t||!1===np(t,"ruleName")){let r=Error(`<SUBRULE${s8(e)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw r.KNOWN_RECORDER_ERROR=!0,r}let n=r9(this.recordingProdStack),i=new nG({idx:e,nonTerminalName:t.ruleName,label:null==r?void 0:r.LABEL,referencedRule:void 0});return n.definition.push(i),this.outputCst?s9:s0}consumeInternalRecord(t,e,r){if(s4(e),!iG(t)){let r=Error(`<CONSUME${s8(e)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw r.KNOWN_RECORDER_ERROR=!0,r}let n=r9(this.recordingProdStack),i=new nq({idx:e,terminalType:t,label:null==r?void 0:r.LABEL});return n.definition.push(i),s2}};function s3(t,e,r,n=!1){s4(r);let i=r9(this.recordingProdStack),s=X(e)?e:e.DEF,o=new t({definition:[],idx:r});return n&&(o.separator=e.SEP),np(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),s0}function s5(t,e){s4(e);let r=r9(this.recordingProdStack),n=!1===k(t),i=!1===n?t:t.DEF,s=new nX({definition:[],idx:e,ignoreAmbiguities:n&&!0===t.IGNORE_AMBIGUITIES});np(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);let o=nb(i,t=>X(t.GATE));return s.hasPredicates=o,r.definition.push(s),r5(i,t=>{let e=new nW({definition:[]});s.definition.push(e),np(t,"IGNORE_AMBIGUITIES")?e.ignoreAmbiguities=t.IGNORE_AMBIGUITIES:np(t,"GATE")&&(e.ignoreAmbiguities=!0),this.recordingProdStack.push(e),t.ALT.call(this),this.recordingProdStack.pop()}),s0}function s8(t){return 0===t?"":`${t}`}function s4(t){if(t<0||t>255){let e=Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than 256`);throw e.KNOWN_RECORDER_ERROR=!0,e}}var s7=class{initPerformanceTracer(t){if(np(t,"traceInitPerf")){let e=t.traceInitPerf,r="number"==typeof e;this.traceInitMaxIdent=r?e:1/0,this.traceInitPerf=r?e>0:e}else this.traceInitMaxIdent=0,this.traceInitPerf=oe.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,e){if(!0!==this.traceInitPerf)return e();{this.traceInitIndent++;let r=Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);let{time:n,value:i}=nF(e),s=n>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(`${r}<-- <${t}> time: ${n}ms`),this.traceInitIndent--,i}}},ot=i6(i9,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(ot);var oe=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:i3,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),or=Object.freeze({recoveryValueFunc:()=>void 0,resyncEnabled:!0});!function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"}(h||(h={}));var on=class t{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;let r=this.className;this.TRACE_INIT("toFastProps",()=>{n$(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),r5(this.definedRulesNames,t=>{let e;let r=this[t].originalGrammarAction;this.TRACE_INIT(`${t} Rule`,()=>{e=this.topLevelRuleRecord(t,r)}),this.gastProductionsCache[t]=e})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=function(t){let e=rZ(t,{errMsgProvider:i5}),r={};return r5(t.rules,t=>{r[t.name]=t}),function(t,e){let r=new i4(t,e);return r.resolveRefs(),r.errors}(r,e.errMsgProvider)}({rules:nd(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(nA(n)&&!1===this.skipValidations){var t,e;let n=function(t,e,r,n){let i=na(t,t=>(function(t,e){let r=new sv;return t.accept(r),no(nd(n_(nl(r.allProductions,sA),t=>t.length>1)),r=>{let n=ni(r),i=e.buildDuplicateFoundError(t,r),s=nQ(n),o={message:i,type:h.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:s,occurrence:n.idx},a=sR(n);return a&&(o.parameter=a),o})})(t,r)),s=function(t,e,r){let n=[],i=no(e,t=>t.name);return r5(t,t=>{let e=t.name;if(nm(i,e)){let i=r.buildNamespaceConflictError(t);n.push({message:i,type:h.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:e})}}),n}(t,e,r),o=na(t,t=>(function(t,e){let r=new sO;return t.accept(r),na(r.alternations,r=>r.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:r}),type:h.TOO_MANY_ALTS,ruleName:t.name,occurrence:r.idx}]:[])})(t,r)),a=na(t,e=>(function(t,e,r,n){let i=[];if(nC(e,(e,r)=>r.name===t.name?e+1:e,0)>1){let e=n.buildDuplicateRuleNameError({topLevelRule:t,grammarName:r});i.push({message:e,type:h.DUPLICATE_RULE_NAME,ruleName:t.name})}return i})(e,t,n,r));return i.concat(s,o,a)}((t=rZ(t={rules:nd(this.gastProductionsCache),tokenTypes:nd(this.tokensMap),errMsgProvider:i8,grammarName:r},{errMsgProvider:i8})).rules,t.tokenTypes,t.errMsgProvider,t.grammarName),i=no((e={lookaheadStrategy:this.lookaheadStrategy,rules:nd(this.gastProductionsCache),tokenTypes:nd(this.tokensMap),grammarName:r}).lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName}),t=>Object.assign({type:h.CUSTOM_LOOKAHEAD_VALIDATION},t));this.definitionErrors=this.definitionErrors.concat(n,i)}}),nA(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{let t=function(t){let e={};return r5(t,t=>{t8(e,new n6(t).startWalking())}),e}(nd(this.gastProductionsCache));this.resyncFollows=t}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var t,e;null===(e=(t=this.lookaheadStrategy).initialize)||void 0===e||e.call(t,{rules:nd(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(nd(this.gastProductionsCache))})),!t.DEFER_DEFINITION_ERRORS_HANDLING&&!nA(this.definitionErrors))throw e=no(this.definitionErrors,t=>t.message),Error(`Parser Definition Errors detected:
 ${e.join("\n-------------------------------\n")}`)})}constructor(t,e){if(this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(e),this.initLexerAdapter(),this.initLooksAhead(e),this.initRecognizerEngine(t,e),this.initRecoverable(e),this.initTreeBuilder(e),this.initContentAssist(),this.initGastRecorder(e),this.initPerformanceTracer(e),np(e,"ignoredIssues"))throw Error("The <ignoredIssues> IParserConfig property has been deprecated.\n	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n	For further details.");this.skipValidations=np(e,"skipValidations")?e.skipValidations:oe.skipValidations}};on.DEFER_DEFINITION_ERRORS_HANDLING=!1,function(t,e){e.forEach(e=>{let r=e.prototype;Object.getOwnPropertyNames(r).forEach(n=>{if("constructor"===n)return;let i=Object.getOwnPropertyDescriptor(r,n);i&&(i.get||i.set)?Object.defineProperty(t.prototype,n,i):t.prototype[n]=e.prototype[n]})})}(on,[s$,sB,sY,sX,sJ,sq,sZ,sQ,s6,s7]);var oi=class extends on{constructor(t,e=oe){let r=ry(e);r.outputCst=!0,super(t,r)}},os=class extends oi{constructor(t,e){super(t,{nodeLocationTracking:"full"}),this.atomTypes=["silent","assign","symbol","choice","pgate","text","entity"],this.textTypes=e,this.buildRules()}parse(t){this.input=t.tokens;let e=this.script();if(this.errors.length>0)throw Error("[PARSING]\n"+this.errors[0].message);return e}buildRules(){let t=this,e=this.tokensMap;t.RULE("script",()=>{t.MANY(()=>t.SUBRULE(t.expr))}),t.RULE("expr",()=>{t.AT_LEAST_ONE(()=>t.SUBRULE(t.atom))}),t.RULE("atom",()=>{t.OR(this.atomTypes.map(e=>({ALT:()=>t.SUBRULE(t[e])})))}),t.RULE("wexpr",()=>{t.MANY(()=>{t.OR([{ALT:()=>t.SUBRULE(t.expr)},{ALT:()=>t.CONSUME(e.Weight)}])})}),t.RULE("symbol",()=>{t.CONSUME(e.Symbol),t.MANY(()=>t.CONSUME(e.Transform))}),t.RULE("choice",()=>{t.CONSUME(e.OC),t.OPTION1(()=>t.SUBRULE(t.gate)),t.SUBRULE(t.orExpr),t.OPTION2(()=>{t.SUBRULE2(t.elseExpr)}),t.CONSUME(e.CC),t.MANY(()=>t.CONSUME(e.Transform))}),t.RULE("assign",()=>{t.CONSUME(e.Symbol),t.CONSUME(e.EQ),t.SUBRULE(t.expr)}),t.RULE("silent",()=>{t.CONSUME(e.OS),t.OPTION1(()=>t.SUBRULE(t.gate)),t.CONSUME(e.Symbol),t.OPTION2(()=>{t.CONSUME(e.EQ),t.SUBRULE(t.expr)}),t.CONSUME(e.CS)}),t.RULE("orExpr",()=>{t.MANY_SEP({SEP:e.OR,DEF:()=>t.SUBRULE(t.wexpr)})}),t.RULE("elseExpr",()=>{t.CONSUME(e.ELSE),t.SUBRULE(t.orExpr)}),t.RULE("pgate",()=>{t.CONSUME(e.PendingGate)}),t.RULE("entity",()=>{t.CONSUME(e.Entity)}),t.RULE("gate",()=>{t.MANY(()=>t.CONSUME(e.Gate))}),t.RULE("text",()=>{t.OR(this.textTypes.map(r=>({ALT:()=>t.CONSUME(e[r])})))}),this.performSelfAnalysis()}},oo=class t{static formatAny(t){if("string"==typeof t)return`'${t}'`;if("number"==typeof t)return t;if("function"==typeof t)throw Error("unexpected function");return JSON.stringify(t).replace(/"/g,"")}static transformNames(t){return t&&t.length?t.map(t=>t.image.replace(/(^\.|\(\)$)/g,""),[]):[]}static escapeText(e,r){if("string"!=typeof e)return t.formatAny(e);let n=e.replace(/\r?\n/g,"\\n");return r||!n.length?"'"+n+"'":n}static stringHash(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r)|0;let r=e.toString().padStart(9,"0");return e<0?r.replace("-","0"):r}static escapeMarkdownLink(t){let e=t;return Object.entries({"[":"&lsqb;","]":"&rsqb;","(":"&lpar;",")":"&rpar;","/":"&sol;"}).forEach(([t,r])=>e=e.replace(RegExp(`\\${t}`,"g"),r)),e}static slashEscToEntities(e){return e=t.replaceAll(e,"\\(","&lpar;"),e=t.replaceAll(e,"\\)","&rpar;"),e=t.replaceAll(e,"\\[","&lsqb;"),e=t.replaceAll(e,"\\]","&rsqb;"),e=t.replaceAll(e,"\\{","&lcqb;"),e=t.replaceAll(e,"\\}","&rcqb;"),e=t.replaceAll(e,"\\@","&commat;"),e=t.replaceAll(e,"\\#","&num;"),e=t.replaceAll(e,"\\|"," &vert"),e=t.replaceAll(e,"\\="," &equals")}static escapeJSONRegex(e){return e.replace(/\/([^/]+?)\/([igmsuy]*)/g,`"${t.RegexEscape}$1${t.RegexEscape}$2${t.RegexEscape}"`)}static escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static replaceAll(e,r,n){return e.replace(RegExp(t.escapeRegExp(r),"g"),()=>n)}};f(oo,"RegexEscape","_RE_");var{escapeText:oa,stringHash:oc,formatAny:ol,transformNames:oh}=oo,ou=class{constructor(t){this.input="",this.nowarn=!1,this.tracePath=!0,this.scripting=t,this.warnOnInvalidGates=!1,this.maxRecursionDepth=10}textFromCstNode(t){return Array.isArray(t)&&(t=t[0]),this.input.substring(t.location.startOffset,t.location.endOffset+1)}isCstNode(t){return Array.isArray(t)&&(t=t[0]),"object"==typeof t&&("accept"in t||"name"in t&&"location"in t&&"children"in t)}visit(t,e){if(Array.isArray(t)&&(t=t[0]),void 0===t)return;if(!this.isCstNode(t))throw Error("Non-cstNode passed to visit: "+JSON.stringify(t));this.nodeText=this.textFromCstNode(t);let r=t.name;if("function"!=typeof this[r])throw Error(`BaseVisitor.visit: expecting function for this[${r}], found ${typeof this[r]}: ${JSON.stringify(this[r])}`);return this[r](t.children,e)}validateVisitor(){}},op=class extends ou{constructor(t,e={}){super(t),this.order=0,this.trace=0,this.indent=0,this.choices={},this.context=e,this.isNoRepeat=!1,this.Symbols=this.scripting.Symbols,this.Escaped=this.scripting.Escaped,this.statics={},this.dynamics={},this.pendingGates={},this.validateVisitor()}start(t={}){if(this.input=t.input,this.trace=t.trace,this.nowarn=t.silent,this.traceTx=t.traceTx,!t.cst)throw Error("no cst");return super.visit(t.cst)}script(t){if(this.order=this.indent=0,1!==Object.keys(t).length)throw Error("script: invalid expr");let e=t.expr[0].children.atom.length;if(this.print("script",`'${oa(this.input)}' :: ${e} atom(s)`),!e)return"";this.indent++;let r=this.visit(t.expr);return this.indent--,this.print("/script"),r}expr(t){let e=Object.keys(t);if(1!==e.length)throw Error("invalid expr: "+e.length);let r=t.atom.map(t=>this.visit(t));if(1===r.length)return r[0];for(let t=1;t<r.length-1;t++)0===r[t].length&&r[t-1].endsWith(" ")&&r[t+1].startsWith(" ")&&(r[t+1]=r[t+1].substring(1));return r.join("")}atom(t){let e;let r=Object.keys(t);if(1!==r.length)throw Error("invalid atom: "+r);return this.scripting.parser.atomTypes.forEach(r=>{if(t[r]){if(1!==t[r].length)throw Error(r+": bad length -> "+t[r].length);"function"==typeof(e=this.visit(t[r][0]))&&(e=e.call())}}),e}silent(t){return this.print("silent",this.nodeText),this.indent++,t.EQ?this.assign(t,{silent:!0}):this.symbol(t,{silent:!0}),this.indent--,this.print("/silent","statics="+ol(this.statics)),""}assign(t,e){let r;let i=t.Symbol[0].image,s=this.nodeText,o=i.replace(this.scripting.regex.AnySymbol,""),a=i.startsWith(this.Symbols.STATIC),c=n([e,"optionalAccess",t=>t.silent]),l=`${s} ${a&&c?"{#static,silent}":(a?"{#static}":"")+(c?"{silent}":"")}`;if(this.print("assign",l),a)o in this.statics&&!this.scripting.isParseable(this.statics[o])?(r=this.statics[o],l=`${i} = ${ol(r)} {#resolved}`):(this.indent++,r=this.visit(t.expr),this.indent--,this.statics[o]=r,"string"==typeof r&&this.scripting.isParseable(r)&&(r=this.inlineStaticAssign(o,t.Transform,r)),l=`${i} = ${ol(r)}`),this.print("/assign",l);else{let e=this;this.indent++,r=()=>e.visit(t.expr),this.indent--,this.dynamics[o]=r,this.print("/assign",`${i} =  <f*:pending>`)}return r}symbol(t,e){if(1!==t.Symbol.length)throw Error("[1] invalid symbol");let r=n([e,"optionalAccess",t=>t.silent]),i=this.nodeText,s=t.Symbol[0].image.replace(/\(\)$/,""),o=s.replace(this.scripting.regex.AnySymbol,"");this.isNoRepeat=this.hasNoRepeat(t.Transform),this.print("symbol",`${i} ${r?" {silent}":""}`);let{result:a,isStatic:c,isUser:l,resolved:h}=this.checkContext(o);if(!c&&this.scripting.regex.StaticSymbol.test(s)&&!this.scripting.regex.Entity.test(s))throw Error(`Attempt to refer to dynamic symbol '${o}' as ${this.Symbols.STATIC}${o}, did you mean $${o}?`);for(let t=0;"function"==typeof a;t++)if(a=a.call(),h=!this.scripting.isParseable(a),t===this.maxRecursionDepth)throw Error("Max recursion depth reached");if(this.isNoRepeat&&(c||l))throw this.isNoRepeat=!1,Error("Attempt to call norepeat() on "+(c?"static symbol '"+s+"'. Did you mean to use '"+this.Symbols.DYNAMIC+o+"' ?":"non-dynamic symbol '"+o+"'. Did you mean to define '"+this.Symbols.DYNAMIC+o+"' in riscript?"));if(void 0===a)return this.print("/symbol",s+" -> '"+i+"' ctx="+this.lookupsToString(),"[deferred]",n([e,"optionalAccess",t=>t.silent])?"{silent}":""),i;let u=n([e,"optionalAccess",t=>t.trace])?`${i.replace(/\(\)$/,"")} -> ${ol(a)}`+(n([e,"optionalAccess",t=>t.silent])?" {silent}":""):null;return"string"!=typeof a||h?(c&&(this.statics[o]=a),t.Transform?(u+="-> '"+(a=this.applyTransforms(a,t.Transform))+"'",this.isNoRepeat&&(u+=" (norepeat)")):0===a.length&&1===s.length&&(a=s,u="** $ **"),this.print("/symbol",u),this.isNoRepeat=!1):c?(a=this.inlineStaticAssign(o,t.Transform,a),this.print("/symbol",`${i} -> ${a}`)):(t.Transform&&(a=this.restoreTransforms(a,t.Transform)),this.print("/symbol",u)),a}choice(t,e){let r=this.Symbols,i=this.nodeText,s=oc(i+" #"+this.choiceId(t)),o,a,c=t.Transform;if(!this.isNoRepeat&&this.hasNoRepeat(t.Transform))throw Error("noRepeat() not allowed on choice (use a $variable instead): "+i);this.print("choice",i);let l="accept";if(n([e,"optionalAccess",t=>t.forceReject]))l="reject";else{let e=n([t,"optionalAccess",t=>t.gate,"optionalAccess",t=>t[0],"optionalAccess",t=>t.children,"optionalAccess",t=>t.Gate]);if(e){o=e[0].image,this.indent++,a=this.visit(t.gate),this.indent--,l=a.decision;let n=`${o} -> ${"defer"!==l?l.toUpperCase():`DEFER ${r.PENDING_GATE}${s}`}  ${this.lookupsToString()}`;this.print("gate",n)}if(a&&"defer"===a.decision)return this.pendingGates[s]={gateText:o,deferredContext:t,operands:a.operands},`${r.PENDING_GATE}${s}`}let h=n([t,"optionalAccess",t=>t.orExpr,"access",t=>t[0]]);if("reject"===l){if(!("elseExpr"in t))return"";h=t.elseExpr[0].children.orExpr[0]}let u=this.parseOptions(h);if(!u)throw Error("No options in choice: "+i);let p=null,f=[],d=!1;for(;null===p;){p=this.choose(u,f);for(let t=0;this.isCstNode(p);t++)if(this.indent++,p=this.visit(p),this.indent--,t===this.maxRecursionDepth)throw Error("Max recursion depth reached");if("string"==typeof p?p=p.trim():"number"!=typeof p&&(t.Transform&&(p=this.applyTransforms(p,t.Transform)),c=!1),this.scripting.isParseable(p)){t.Transform&&(p=this.restoreTransforms(p,t.Transform)),d=!0;break}if(c&&(p=this.applyTransforms(p,t.Transform)),this.isNoRepeat&&p===this.choices[s]){this.print("choice-reject",p+" [norepeat]"),f.push(p),p=null;continue}}return d||(this.choices[s]=p),this.print("choice/",i+" -> '"+p+"'"),p}choose(t,e=[]){if(!t||!t.length)throw Error("Invalid choice: no options");let r=t.filter(t=>!e.includes(t));if(!r.length)throw Error("Invalid choice: no valid options");let n=this.scripting.RiTa.randi(r.length);return r[n]}text(t){if(1!==Object.keys(t).length)throw Error("[2] invalid text");let e=t[this.scripting.textTypes.filter(e=>t[e])][0].image;return this.print("text/",oa("'"+e+"'")),e}entity(t){return this.nodeText}gate(t){if(1!==t.Gate.length)throw Error("Invalid gate: "+t.Gate);let e=t.Gate[0].image,r;e.startsWith(this.Symbols.OPEN_GATE)&&(e=e.substring(1));try{r=this.scripting.createQuery(e)}catch(t){if(!this.warnOnInvalidGates)throw Error(`Invalid gate[2]: "@${e}"

RootCause -> ${t}`);return this.scripting.RiTa.SILENT||this.nowarn||console.warn(`[WARN] Ignoring invalid gate: @${e}@
`,t),{decision:"accept"}}let n={},i=[],s=r.operands();if(s.forEach(t=>{let{result:e,resolved:r,isStatic:s,isUser:o}=this.checkContext(t);for(let t=0;"function"==typeof e;t++)if(e=e.call(),r=!this.scripting.isParseable(e),t===this.maxRecursionDepth)throw Error("Max recursion depth reached");void 0!==e&&r?(s?this.statics[t]=e:o?this.context[t]=e:this.dynamics[t]=e,n[t]=e):i.push(t)}),Object.keys(n).length+i.length!==s.length)throw Error("invalid operands");if(i.length)return{decision:"defer",operands:i};let o=r.test(n);return!o&&this.castValues(n)&&(o=r.test(n)),{decision:o?"accept":"reject"}}pgate(t){this.print("pgate",this.nodeText);let e=this.nodeText,r=e.replace(this.Symbols.PENDING_GATE,""),n=this.pendingGates[r];if(!n)throw Error('no pending gate="'+e+'" pgates='+JSON.stringify(Object.keys(this.pendingGates)));return n.operands.some(t=>{let{result:e,resolved:r}=this.checkContext(t);return"function"==typeof e&&(e=e.call(),r=!this.scripting.isParseable(e)),void 0===e||!r})?e:this.choice(n.deferredContext)}else(t){return this.visit(t.expr).trim()}hasNoRepeat(t){let e=oh(t);return!!e.length&&(e.includes("nr")||e.includes("norepeat"))}checkContext(t,e={}){let r,n=!1,i=!1;if(0===t.length)return{result:"",resolved:!0,isStatic:n,isUser:i};void 0===(r=this.dynamics[t])&&void 0!==(r=this.statics[t])&&(n=!0),void 0===r&&void 0!==(r=this.context[t])&&(i=!0),void 0===r&&(r=this.scripting.transforms[t]);let s=!this.scripting.isParseable(r);return{result:r,isStatic:n,isUser:i,resolved:s}}inlineStaticAssign(t,e,r){let n=this.Symbols,i=n.STATIC+t,s=r,o=n.OPEN_CHOICE+(i+"=")+s+n.CLOSE_CHOICE;return r=this.restoreTransforms(o,e)}choiceId(t){if(!t.OC||!t.OC.length)throw Error("invalid choice");return t.OC[0].startOffset+"."+t.OC[0].endOffset}parseOptions(t){let e=[];if(t&&n([t,"optionalAccess",t=>t.children,"optionalAccess",t=>t.wexpr])){let r=t.children.wexpr;for(let t=0;t<r.length;t++){let n=r[t],i=n.children.expr;if(i&&1!=i.length)throw Error("invalid choice-expr: "+i.length);let s=n.children.Weight;if(s){if(1!=s.length)throw Error("invalid weight: "+s.length);let t=1;try{t=parseInt(this.Symbols.CLOSE_WEIGHT.length?s[0].image.trim().slice(1,-1):s[0].image.trim().slice(1))}catch(e){console.log("EX: "+t)}Array.from({length:t},()=>e.push(i))}else e.push(i||"")}}return e}applyTransforms(t,e){this.indent++,this.traceTx&&console.log("applyTransforms",this.formatTxs(...arguments));for(let r=0;r<e.length;r++)t=this.applyTransform(t,e[r]);return this.indent--,t}applyTransform(t,e){let r;let n=e.image,i=t+n,s=ol(t)+n,o=n.substring(1).replace(/\(\)$/,""),a=this.scripting.RiTa;return"function"==typeof this.dynamics[o]?r=this.dynamics[o].bind(this.context)(t):"function"==typeof this.statics[o]?r=this.statics[o].call(this.context,t):"function"==typeof this.context[o]?r=this.context[o].call(this.context,t):"function"==typeof this.scripting.transforms[o]?r=this.scripting.transforms[o].call(this.context,t):"function"==typeof t[o]?r=t[o]():t.hasOwnProperty(o)?r=t[o]:(a.SILENT||this.silent||console.warn("[WARN] Unresolved transform: "+i),r=i.replace(/\(\)$/,"&lpar;&rpar;")),this.print("transform/",`${s} -> '${r}'`),r}restoreTransforms(t,e){if("string"==typeof t){let r=RegExp("^"+this.Escaped.OPEN_CHOICE+".*"+this.Escaped.CLOSE_CHOICE+"$"),n=RegExp(`(${this.Escaped.DYNAMIC}|${this.Escaped.STATIC}[A-Za-z_0-9])[A-Za-z_0-9]*`);r.test(t)||n.test(t)||(t=this.Symbols.OPEN_CHOICE+t+this.Symbols.CLOSE_CHOICE),e&&e.forEach(e=>t+=e.image),this.traceTx&&console.log("restoreTransforms:",t)}return t}castValues(t){let e=!1;return Object.entries(t).forEach(([r,n])=>{let i=parseFloat(n);isNaN(i)||(e=!0,t[r]=i)}),e}contextIsResolved(t){let e=!0;return Object.entries(t).forEach(([t,r])=>{this.scripting.isParseable(r)||(e=!1)}),e}lookupsToString(){let t={},e={};return Object.entries(this.dynamics||{}).forEach(([e,r])=>t[`$${e}`]=r),Object.entries(this.statics||{}).forEach(([t,r])=>e[`#${t}`]=r),JSON.stringify({...this.context,...e,...t},(t,e)=>"function"==typeof e?"<f*:pending>":e).replace(/"/g,"")}formatTxs(t,e){return t+e.map(t=>t.image.replace(/()/,"")+"()").join("")}print(t,...e){if(this.trace){let r="  ".repeat(this.indent),n=`${r}<${t}>${t.startsWith("/")?"":" "}`;++this.order<10&&(n=" "+n),console.log(this.order,n,...e)}}};function of(t,e){if(!/^@/.test(t.substring(e)))return null;let r=e+1,n=t.charCodeAt(r);for(;32===n;)r++,n=t.charCodeAt(r);if(123!==n)return null;r++,n=t.charCodeAt(r);let i=1;for(;i>0;)123===n?i++:125===n&&i--,r++,n=t.charCodeAt(r);return r===e?null:[t.substring(e,r)]}var od=["Raw","STAT","AMP"],oE=class t{constructor(t={},e={},r={}){if(this.rules={},this.context=e,this.scripting=function(t,e){return null!=t?t:e()}(n([r,"access",t=>t.RiTa,"optionalAccess",t=>t.riscript]),()=>new oS(r)),"string"==typeof t&&(t=om(t)),"object"!=typeof t)throw Error("RiGrammar: expecting object, found "+typeof t);this.setRules(t)}static expand(e,r,n){return new t(e,r).expand(n)}addTransform(t,e){return this.scripting.addTransform(t,e),this}removeTransform(t){return this.scripting.removeTransform(t),this}getTransforms(){return this.scripting.getTransforms()}equals(t){return t.toJSON()===this.toJSON()}expand(t={}){if("context"in t)throw Error("pass context to RiScript.grammar() or new RiGrammar() instead");let e=new op(this.scripting);e.context=this.context||{};let r={...t,visitor:e,input:this._toScript(t)};return this.scripting._evaluate(r)}addRule(t,e){return this._validateRule(t,e),this.rules[t]=e,this}setRules(t){if(void 0===t)throw Error("undefined rules");return this.rules={},Object.entries("string"==typeof t?om(t):t).forEach(t=>this.addRule(...t)),this}removeRule(t){return t in this.rules&&delete this.rules[t],this}toJSON(t,e){return JSON.stringify(this.rules,t,e)}toString(t={}){let e=t.replacer||0,r=t.space||2,i=n([t,"optionalAccess",t=>t.linebreak]),s=this.toJSON(e,r);return i&&(s=s.replace(/\n/g,i)),s}static fromJSON(e,r){return new t(JSON.parse(e),r)}_toScript(t){let e="",r=t.start||"start",{Symbols:n}=this.scripting;if(r.startsWith(n.DYNAMIC)&&(r=r.substring(n.DYNAMIC.length)),r.startsWith(n.STATIC)&&(r=r.substring(n.STATIC.length)),!(r in this.rules||n.STATIC+r in this.rules))throw Error('Rule: "'+r+'" not found in grammar');return Object.entries(this.rules).forEach(([t,r],i)=>{for(;t.startsWith(n.DYNAMIC);)t=t.substring(1);t.startsWith(n.STATIC)||(t=n.DYNAMIC+t),this.scripting.regex.ChoiceWrap.test(r)||(r=n.OPEN_CHOICE+r+n.CLOSE_CHOICE),e+=`${t}=${r}
`}),t.trace&&console.log("Grammar:\n"+e.replace(/^\$/gm,"  $")),e+=`${n.DYNAMIC}${r}`}_validateRule(t,e){if("string"!=typeof t||0===t.length)throw Error("expected [string] name");if(void 0===e)throw Error("undefined rule def: "+t);let{Symbols:r}=this.scripting;if(t.startsWith(r.DYNAMIC))throw t=t.substring(r.DYNAMIC.length),Error("Grammar rules are dynamic by default; if you need a static rule, use '"+r.STATIC+t+"', otherwise just use '"+t+"'.")}};function om(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){throw Error("RiGrammar appears to be invalid JSON, please check it at http://jsonlint.com/\n"+t)}}f(oE,"RiScript",null);var{decode:og}=d.default,oT=/[aeiou]/,oy=/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/gi,{escapeText:oA,slashEscToEntities:oR,escapeMarkdownLink:ov,escapeJSONRegex:oO}=oo,oI=class extends E.Query{constructor(t,e,r){if("string"!=typeof e)try{e=JSON.stringify(e)}catch(t){throw Error(e.toString().includes("@")?"Replace @ with $ when passing an object to RiQuery\nRoot: "+t:t)}if(!e.includes("$"))throw Error("Invalid Gate: '"+e+"' -> operand must include $symbol or $function()");e=e.replace(/(\$|\(\))/g,"").replace(/@/g,"$"),super(e=t.parseJSOL(e),r)}test(t){let e=this.compiled;for(let r=0,n=e.length;r<n;r++)if(!e[r](t))return!1;return!0}operands(){let t=[this.condition],e=new Set;for(;n([t,"optionalAccess",t=>t.length])>0;){let r=t.pop();Object.keys(r).forEach(n=>{let i=r[n];n.startsWith("$")||e.add(n),"object"==typeof i&&null!==i&&(Array.isArray(i)?i:[i]).forEach(e=>t.push(e))})}return Array.from(e)}},oN=class t{static grammar(t,e,r){return new oE(t,e,r)}static evaluate(e,r,n={}){return new t(n).evaluate(e,r,n)}constructor(t={}){this.Escaped=void 0,this.Symbols=void 0,this.visitor=void 0,this.v2Compatible=2===t.compatibility;let{Constants:e,tokens:r}=function(t){let e={OR:"|",ELSE:"||",DYNAMIC:"$",STATIC:"#",ENTITY:"&",OPEN_GATE:"@",PENDING_GATE:"@@",OPEN_SILENT:"{",CLOSE_SILENT:"}"};Object.assign(e,t?{OPEN_CHOICE:"(",CLOSE_CHOICE:")",OPEN_WEIGHT:"[",CLOSE_WEIGHT:"]",CONTINUATION:"\\"}:{OPEN_CHOICE:"[",CLOSE_CHOICE:"]",OPEN_WEIGHT:"^",CLOSE_WEIGHT:"^",CONTINUATION:"~"});let r={};Object.entries(e).forEach(([t,e])=>{r[t]=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")});let n=RegExp(`${r.PENDING_GATE}([0-9]{9,11})`);r.SPECIAL=Object.values(r).join("").replace(/[<>@]/g,"");let i=i2({name:"DYN",pattern:new RegExp(r.DYNAMIC)}),s=i2({name:"STAT",pattern:new RegExp(r.STATIC)}),o=i2({name:"OC",pattern:RegExp(r.OPEN_CHOICE+"\\s*")}),a=i2({name:"CC",pattern:RegExp(`\\s*${r.CLOSE_CHOICE}`)}),c=i2({name:"OS",pattern:RegExp(`${r.OPEN_SILENT}\\s*`)}),l=i2({name:"CS",pattern:RegExp(`\\s*${r.CLOSE_SILENT}`)}),h=i2({name:"ELSE",pattern:/\s*\|\|\s*/}),u=i2({name:"OR",pattern:/\s*\|\s*/}),p=i2({name:"EQ",pattern:/\s*=\s*/}),f=i2({name:"AMP",pattern:/&/}),d=i2({name:"Symbol",pattern:RegExp(`(${r.DYNAMIC}|${r.STATIC}[A-Za-z_0-9])[A-Za-z_0-9]*(\\(\\))?`)}),E=i2({name:"Transform",pattern:/\.[A-Za-z_0-9][A-Za-z_0-9]*(\(\))?/}),m=i2({name:"Entity",pattern:/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/i}),g=i2({name:"Weight",pattern:RegExp(`\\s*${r.OPEN_WEIGHT}\\d+${r.CLOSE_WEIGHT}\\s*`)}),T=i2({name:"PendingGate",pattern:n}),y=i2({name:"Raw",pattern:RegExp(`[^${r.SPECIAL}]+`)});return{tokens:[i2({name:"Gate",line_breaks:!0,pattern:of}),m,g,h,o,a,u,p,d,i,s,f,E,c,l,T,y],Constants:{Symbols:e,Escaped:r}}}(this.v2Compatible);({Escaped:this.Escaped,Symbols:this.Symbols}=e),this.pendingGateRe=RegExp(`${this.Escaped.PENDING_GATE}([0-9]{9,11})`,"g"),this.textTypes=od,this.RiTa=t.RiTa||{VERSION:0,randi:t=>Math.floor(Math.random()*t)},this.transforms=this._createTransforms(),this.regex=this._createRegexes(r),this.lexer=new iK(r),this.parser=new os(r,od)}lex(t){if(!t.input)throw Error("no input");let e=this.lexer.tokenize(t.input);if(e.errors.length)throw console.error("Input: "+t.input+"\n",e.errors[0].message),Error("[LEXING] "+e.errors[0].message);t.traceLex&&this._printTokens(e.tokens),t.tokens=e.tokens}parse(t){t.cst=this.parser.parse(t)}visit(t){return this.visitor.start(t)}evaluate(t,e,r){if("string"!=typeof t)throw Error("evaluate() expects a string, got "+typeof t);return"object"!=typeof r&&(r={}),r.input=t,r.visitor=new op(this,e),this._evaluate(r)}lexParseVisit(t={}){return this.lex(t),this.parse(t),this.visit(t)}addTransform(t,e){return this.transforms[t]=e,this}getTransforms(){return Object.keys(this.transforms)}removeTransform(t){return delete this.transforms[t],this}_evaluate(t){var e,r;let{input:n,visitor:i,trace:s,onepass:o,silent:a}=t;if(!n)throw Error("no input");if(!i)throw Error("no visitor");let c,l=this.regex.EndingBreak.test(n),h=this._preParse(n,t);if(!h)return"";if(!t.visitor)throw Error("no visitor");this.visitor=t.visitor,delete t.visitor,s&&(console.log(`
Input:  '${oA(n)}' ctx=${i.lookupsToString()}`),n!==h&&console.log(`Parsed: '${oA(h)}'`));for(let n=1;h!==c&&n<=10&&(c=h,s&&console.log("-".repeat(20)+" Pass#"+n+" "+"-".repeat(20)),t.input=h,e=this.lexParseVisit(t),r=()=>"",h=null!=e?e:r(),s&&console.log(`Result(${n}) -> "${oA(h||"")}" ctx=${this.visitor.lookupsToString()}`),!o&&this.isParseable(h));n++);return!a&&!this.RiTa.SILENT&&this.regex.ValidSymbol.test(h.replace(oy,""))&&console.warn('[WARN] Unresolved symbol(s) in "'+h.replace(/\n/g,"\\n")+'" '),this._postParse(h,t)+(l?"\n":"")}_printTokens(t){console.log("\nTokens: [ "+t.reduce((t,e)=>{let{name:r}=e.tokenType,n=r;return"TEXT"===n&&(n=oA(e.image,!0)),"Symbol"===n&&(n="sym("+e.image+")"),"TX"===n&&(n="tx("+e.image+")"),t+n+", "},"").slice(0,-2)+" ]\n")}_preParse(t,e){if("string"!=typeof t)return"";let r=this.Symbols,n=t;this.v2Compatible||(n=n.replace(this.regex.ParenthesizedWeights,"^$1^"));let i=n.match(this.regex.MarkdownLinks);i&&i.forEach(t=>n=n.replace(t,ov(t)));let s="",o=(n=oR(n=(n=(n=n.replace(this.regex.MultiLineComments,"")).replace(this.regex.SingleLineComments,"")).replace(this.regex.Continue,""))).split(this.regex.LineBreaks);for(let t=0;t<o.length;t++)if(this.regex.RawAssign.test(o[t])){let e=o[t].indexOf("=");if(e<0)throw Error("invalid state: no assigment: "+o[t]);let n=o[t].substring(0,e),i=o[t].substring(e+1),a=o_(i,r.OPEN_CHOICE),c=o_(i,r.CLOSE_CHOICE);for(;a>c;){let e=o[++t];i+="\n"+e,a+=o_(e,r.OPEN_CHOICE),c+=o_(e,r.CLOSE_CHOICE)}s+=r.OPEN_SILENT+(n+"=")+i+r.CLOSE_SILENT}else s+=o[t],t<o.length-1&&(s+="\n");return s}createQuery(t,e){return new oI(this,t,e)}_postParse(t,e){if("string"!=typeof t)return"";let r=og(t).replace(this.regex.Whitespace," ").replace(this.regex.EndingBreak,""),n=[...r.matchAll(this.pendingGateRe)];return e.trace&&n.length&&console.log("-".repeat(20)+" pGates "+"-".repeat(20)),this.visitor.order=0,n.forEach(t=>{if(!t||!t[0]||!t[1])throw Error("bad gate: "+t);let n=this.visitor.pendingGates[t[1]];if(!n)throw Error("no deferredGate: "+t[1]);let{deferredContext:i,operands:s,gateText:o}=n;if(!s.length)throw Error("no operands");let a=this.visitor.choice(i,{forceReject:!0});r=r.replace(t[0],a),e.trace&&console.log("Unresolved gate: '"+o+"' {reject}")}),e.trace&&console.log(`
Final: '${r}'`),e.preserveLookups||(this.visitor.statics=void 0,this.visitor.dynamics=void 0),r}parseJSOL(t){let e=JSON.parse(oO(t).replace(this.regex.JSOLIdent,'"$1":').replace(/'/g,'"')),r=t=>{let e=oo.RegexEscape,r=t;if("string"==typeof t&&t.startsWith(e)&&t.endsWith(e)){let n=t.split(e);if(4!==n.length)throw Error("invalid regex in unescape");r=new RegExp(n[1],n[2])}return r};return Object.keys(e).forEach(t=>e[t]=r(e[t])),e}isParseable(t){let e=!0;return"number"==typeof t&&(t=t.toString()),"string"==typeof t&&(e=this.regex.Special.test(t)||t.includes(this.Symbols.PENDING_GATE)),e}static pluralize(e,r){return n([r,"optionalAccess",t=>t.pluralize])?r.pluralize(e):(t.RiTaWarnings.plurals||t.RiTaWarnings.silent||(t.RiTaWarnings.plurals=!0,console.warn("[WARN] Install RiTa for proper pluralization")),e.endsWith("s")?e:e+"s")}static articlize(e,r){if(!e||!e.length)return"";let i=e.split(/\s+/)[0];if(!n([r,"optionalAccess",t=>t.phones]))return t.RiTaWarnings.phones||t.RiTaWarnings.silent||(console.warn("[WARN] Install RiTa for proper phonemes"),t.RiTaWarnings.phones=!0),(/^[aeiou].*/i.test(i)?"an ":"a ")+e;let s=r.phones(i,{silent:!0});return(n([s,"optionalAccess",t=>t.length])&&oT.test(s[0])?"an ":"a ")+e}static capitalize(t){return t?t[0].toUpperCase()+t.substring(1):""}static uppercase(t){return t?t.toUpperCase():""}static quotify(t){return"&#8220;"+(t||"")+"&#8221;"}static identity(t){return t}_createRegexes(t){let e=this.Escaped,r=e.OPEN_CHOICE,n=e.CLOSE_CHOICE,i=e.STATIC+e.DYNAMIC;return{LineBreaks:/\r?\n/,EndingBreak:/\r?\n$/,NonGateAtSigns:/([^}])@(?!{)/,AnySymbol:RegExp(`[${i}]`),ParenthesizedWeights:/\(\s*(\d+)\s*\)/g,MultiLineComments:/\/\*[^]*?(\r?\n)?\//g,SingleLineComments:/\/\/[^\n]+(\r?\n|$)/g,MarkdownLinks:/\[([^\]]+)\]\(([^)"]+)(?: \"([^\"]+)\")?\)/g,RawAssign:RegExp(`^[${i}][A-Za-z_0-9][A-Za-z_0-9]*\\s*=`),JSOLIdent:RegExp(`([${i}]?[A-Za-z_0-9][A-Za-z_0-9]*)\\s*:`,"g"),ChoiceWrap:RegExp("^"+r+"[^"+r+n+"]*"+n+"$"),ValidSymbol:RegExp("("+e.DYNAMIC+"|"+e.STATIC+"[A-Za-z_0-9])[A-Za-z_0-9]*"),Entity:t.filter(t=>"Entity"===t.name)[0].PATTERN,StaticSymbol:RegExp(e.STATIC+"[A-Za-z_0-9][A-Za-z_0-9]*"),Special:RegExp(`[${e.SPECIAL.replace("&","")}]`),Continue:RegExp(e.CONTINUATION+"\\r?\\n","g"),Whitespace:/[\u00a0\u2000-\u200b\u2028-\u2029\u3000]+/g}}_createTransforms(){let e={quotify:e=>t.quotify(e),pluralize:e=>t.pluralize(e,this.RiTa),articlize:e=>t.articlize(e,this.RiTa),capitalize:e=>t.capitalize(e),uppercase:e=>t.uppercase(e),norepeat:e=>t.identity(e)};return e.art=e.articlize,e.nr=e.norepeat,e.cap=e.capitalize,e.uc=e.uppercase,e.qq=e.quotify,e.s=e.pluralize,e.ucf=e.capitalize,e}};f(oN,"VERSION","1.1.1"),f(oN,"Query",oI),f(oN,"RiTaWarnings",{plurals:!1,phones:!1,silent:!1});var oS=oN;function o_(t,e){let r=0;for(let n=0;n<t.length;n++)t[n]===e&&r++;return r}oS.Visitor=op,oS.Util=oo,e.RiGrammar=oE,e.RiScript=oS}}]);